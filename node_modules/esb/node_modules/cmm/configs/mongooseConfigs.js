/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */

var mongooseODMs = [];

function getDBServer(){

    if(process.env.STAGE ==='production')
    {
       return 'bosbok';
    }
    else if(process.env.STAGE ==='development')
    {
        return 'bosbok';
    }
    else {
        return 'localhost';
    }
}

module.exports.getMongoose  = function(paramDB){

        var connString = 'mongodb://'+ getDBServer() + '/'  + paramDB;

        var mongooseODM = require('mongoose');
        mongooseODM = new mongooseODM.Mongoose();
        mongooseODM.connect(connString);
        mongooseODMs.push(mongooseODM);
        console.log('cmm: connecting to mongodb for '+ mongooseODM.connection.name);
        console.log('cmm: sending mongodb dependency to ' + mongooseODM.connection.name);
        return mongooseODM;
};

process.on('SIGINT', function(){

    for (var i in mongooseODMs){
        console.log('db connection ready state: ' + mongooseODMs[i].connection.readyState );
        mongooseODMs[i].connection.close(function(){
            console.log('Mongoose disconnected due to application termination...');
            //conn = mongooseODM.connection;

    });
    }
    process.exit(0);
});

