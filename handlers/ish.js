/** * Created by rollandsafort on 4/14/15. */var oHelpers = require('../utilities/helpers.js');var q = require('q');//details/search/...module.exports = function(paramService, esbMessage){    var searchRouter = paramService.Router();    searchRouter.get('/all.json', function(paramRequest, paramResponse){        console.log(' search all detail pages---');        var m1 = {            "ns":"upm",            "op": "readAllCorporateDetailPageByID",            "pl":{oID:paramRequest.user.currentOrganization                ,uID: paramRequest.user.lanzheng.loginName                ,pageSize:10            }        };        var m2 = {            "ns":"smm",            "op": "smm_readAllServicePointDetails",            "pl":{oID:paramRequest.user.currentOrganization                ,uID: paramRequest.user.lanzheng.loginName                ,pageSize:10            }        };        var m3 = {            "ns":"bmm",            "op": "bmm_readAllActivityDetails",            "pl":{oID:paramRequest.user.currentOrganization                ,uID: paramRequest.user.lanzheng.loginName                ,pageSize:10            }        };        var p1 = esbMessage(m1);        var p2 = esbMessage(m2);        var p3 = esbMessage(m3);        q.all([p1,p2,p3])                .then(function(r) {                var mergedJson = r[0].pl.concat(r[1].pl,r[2].pl);                    oHelpers.sendResponse(paramResponse,200,mergedJson);                })                .fail(function(r) {                    console.log(r.er);                    var r = {pl:null, er:{ec:404,em:"could not find searched element"}};                    oHelpers.sendResponse(paramResponse,404,r);                });    });    return searchRouter;}