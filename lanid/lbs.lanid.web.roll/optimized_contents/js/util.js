if(!(console&&console.log)){console={log:function(){}};}var DEFAULT_PAGINATION_PAGE=0;var DEFAULT_PAGINATION_SIZE=10;var DEFAULT_PAGINATION_MAXPAGES=5;findInArray=function(array,fn){for(var i=0;i<array.length;i++){if(fn(array[i])){return i;}}return-1;}
calculatePaginationElements=function(totalCount,requestedPage,requestedPageSize,doHyphentruncation){if(requestedPage===undefined)requestedPage=DEFAULT_PAGINATION_PAGE;if(requestedPageSize===undefined)requestedPageSize=DEFAULT_PAGINATION_SIZE;if(totalCount===undefined)totalCount=0;requestedPage=parseInt(requestedPage);requestedPageSize=parseInt(requestedPageSize);totalCount=parseInt(totalCount);var total_logical_pages=Math.ceil(totalCount/requestedPageSize);var pagination_elements=[];if(total_logical_pages==0){var ele={label:i+1,isLink:true,p:0,ps:requestedPageSize,current:true};pagination_elements.push(ele);}else if(total_logical_pages<=DEFAULT_PAGINATION_MAXPAGES){for(var i=0;i<total_logical_pages;i++){var ele={label:i+1,isLink:true,p:i,ps:requestedPageSize,current:requestedPage==i};pagination_elements.push(ele);}}else{var reqIDX=parseInt(requestedPage);pagination_elements[reqIDX]={label:parseInt(requestedPage)+1,isLink:true,p:requestedPage,ps:requestedPageSize,current:true};var leftOvershoot=0,rightOvershoot=0;for(var i=1;i<DEFAULT_PAGINATION_MAXPAGES;i++){var scalarStep=i;var log1=reqIDX-scalarStep;var log2=reqIDX+scalarStep;if(log1<0)leftOvershoot++;if(log2>total_logical_pages)rightOvershoot++;pagination_elements[log1]={label:log1+1,isLink:true,p:log1,ps:requestedPageSize,current:false};pagination_elements[log2]={label:log2+1,isLink:true,p:log2,ps:requestedPageSize,current:false};}pagination_elements=pagination_elements.filter(function(ele,k){return ele&&ele.p>=0&&ele.p<total_logical_pages});var currAt=findInArray(pagination_elements,function(ele){return ele.current});var unsliced=pagination_elements.length;if(false&&unsliced!=2*DEFAULT_PAGINATION_MAXPAGES-1){if(currAt<=DEFAULT_PAGINATION_MAXPAGES/2){pagination_elements=pagination_elements.slice(0,DEFAULT_PAGINATION_MAXPAGES);}else{pagination_elements=pagination_elements.slice(pagination_elements.length-DEFAULT_PAGINATION_MAXPAGES-rightOvershoot,pagination_elements.length)}}else{var left=Math.max(currAt-Math.floor(DEFAULT_PAGINATION_MAXPAGES/2)-(rightOvershoot>0?rightOvershoot-1:0),0);var right=currAt+Math.floor(DEFAULT_PAGINATION_MAXPAGES/2)+1+(leftOvershoot>1?leftOvershoot-2:0)
pagination_elements=pagination_elements.slice(left,right)}}return pagination_elements;}
receiveGetPageResponse=function(msg,requestedPage,requestedPageSize){if(requestedPage===undefined)requestedPage=DEFAULT_PAGINATION_PAGE;if(requestedPageSize===undefined)requestedPageSize=DEFAULT_PAGINATION_SIZE;if(msg.mt&&msg.mt.p==requestedPage&&msg.mt.ps==requestedPageSize&&msg.mt.tc!==undefined){return msg;}else if(!msg.mt){console.log("b");var min_idx=requestedPage*requestedPageSize;var max_idx=(requestedPage+1)*requestedPageSize;msg.mt={_inferred:true,p:requestedPage,ps:requestedPageSize}
if(msg.pl){msg.mt.tc=msg.pl.length;msg.pl=msg.pl.slice(min_idx,max_idx);}else{msg.mt.tc=0;}return msg;}else{throw new Error("INCONSISTENT PAGINATION PARAMETERS ON RESPONSE: Got "+JSON.stringify(msg.mt)+", but was expecting {page:"+requestedPage+", pageSize:"+requestedPageSize+", totalQueryResultCount: < some number >}");}}
var lbs={};lbs.modHelper=function(arg){this.url=null;this.type=null;this.start=null;this.cache=lbs.cache;this.d=null;};lbs.fistTimeLogin=false;lbs.modules={};lbs.loadingMods={};lbs.loadedModules={};lbs.cache={};lbs.browsers={};lbs.routes={};lbs.settings={};lbs.servicePointMap={latitude:121.439936,longitude:31.205326};(function(){lbs.settings.lang='cn';lbs.settings.messages={cn:{}};lbs.settings.messages.validate={};lbs.settings.messages.validate.service={'NAME_EMPTY':'服务名称不能为空','STANDARD_PRICE_NOT_NUMBER':'服务价格必须是一个数字','DISCOUNT_PRICE_NOT_NUMBER':'优惠价格必须是一个数字'};lbs.settings.version='?v=1.030';lbs.settings.views={interTemplate:'/home/home.html',logedInInterTemplate:'/home/loggedInHome.html',masterTemplate:"/home/master.html"};lbs.settings.messages.serviceStatus={'10':{val:10,text:'等待'},'20':{val:20,text:'未处理'},'30':{val:30,text:'已付款'},'40':{val:40,text:'正在处理'},'50':{val:50,text:'已处理'},'51':{val:51,text:'取消'}};lbs.settings.messages.status={'0':{id:0,text:'未创建'},'10':{id:10,text:'等待'},'20':{id:20,text:'待处理'},'30':{id:30,text:'成功'},'40':{id:40,text:'拒绝'}};lbs.settings.messages.userlimits=[{val:'0',text:'无需求'},{val:'20',text:'已认证个人用户'},{val:'30',text:'已认证单位用户'},{val:'40',text:'认证用户'},{val:'50',text:'名单内用户'}];lbs.settings.messages.userlimits.object={'无需求':{val:0,text:'无需求'},'注册用户':{val:10,text:'注册用户'},'实名用户':{val:20,text:'实名用户'},'单位用户':{val:30,text:'单位用户'}};lbs.settings.messages.standardPaymentActivities=[{val:'10',text:'响应用户付款'},{val:'20',text:'预付款统一结算'},{val:'30',text:'后付款统一结算'}];lbs.settings.messages.standardPayment=[{val:'1',text:'在线支付'},{val:'2',text:'现场支付'}];lbs.settings.messages.cn.standardPayment=lbs.settings.messages.standardPaymentActivities;lbs.settings.messages.cn.activityTypes=[{val:"1",text:"证件办理事务"},{val:"2",text:"中小学教育与学生学业事务"},{val:"3",text:"高等教育与学生学业事务"},{val:"4",text:"考试报名事务"},{val:"5",text:"中国出入境事务"},{val:"6",text:"亚洲国家签证事务"},{val:"7",text:"欧洲国家签证事务"},{val:"8",text:"北美洲国家签证事务"},{val:"9",text:"南美洲国家签证事务"},{val:"10",text:"大洋洲国家签证事务"},{val:"11",text:"非洲国家签证事务"},{val:"12",text:"信用评价事务"},{val:"13",text:"银行金融事务"},{val:"14",text:"证券期货事务"},{val:"15",text:"网站备案事务"},{val:"16",text:"网站注册认证事务"},{val:"17",text:"电信服务事务"},{val:"18",text:"求职应聘事务"},{val:"19",text:"人事管理事务"},{val:"20",text:"体育运动事务"},{val:"21",text:"自愿者事务"},{val:"22",text:"公益服务事务"},{val:"23",text:"大型活动事务"},{val:"24",text:"医疗健康事务"},{val:"25",text:"物流管理事务"},{val:"26",text:"家政服务事务"},{val:"27",text:"物业服务事务"},{val:"28",text:"交运服务事务"},{val:"29",text:"商贸服务事务"},{val:"30",text:"调研统计事务"},{val:"31",text:"政务服务事务"},{val:"32",text:"法律服务事务"},{val:"33",text:"婚介服务事务"},{val:"34",text:"社交服务事务"},{val:"35",text:"房地产服务事务"},{val:"36",text:"商务旅行事务"},{val:"37",text:"服饰服务事务"},{val:"38",text:"餐饮服务事务"},{val:"39",text:"文化娱乐事务"},{val:"40",text:"彩票服务事务"},{val:"41",text:"其它"}];lbs.settings.messages.cn.publishingStatus=[{val:"1",text:"未创建"},{val:"4",text:"创建中"},{val:"7",text:"未发布"},{val:"10",text:"审核中"},{val:"40",text:"拒绝"},{val:"30",text:"已发布"},{val:"60",text:"已暂停"},{val:"70",text:"已终止"}];lbs.settings.messages.cn.responseStatus=[{val:"10",text:"已创建"},{val:"20",text:"已提交"},{val:"30",text:"已响应"},{val:"40",text:"享受服务中"},{val:"45",text:"已完成"}];lbs.settings.messages.cn.publishingType=[{val:"10",text:"自主发布"},{val:"20",text:"代理（委托）发布"}];lbs.settings.messages.cn.splitting=[{val:"10",text:"服务完成"},{val:"20",text:"响应完成"},{val:"30",text:"事务完成"}];lbs.settings.messages.cn.splittingPhase=[{val:"10",text:"每日清分"},{val:"20",text:"每周清分"},{val:"30",text:"每月清分"},{val:"40",text:"每季清分"},{val:"50",text:"半年清分"},{val:"60",text:"按年清分"},{val:"70",text:"按双月清分"}];lbs.settings.messages.cn.gender=[{val:"10",text:"不限定"},{val:"20",text:"仅男性"},{val:"30",text:"仅女性"}];lbs.settings.messages.cn.userType=[{val:"10",text:"不限定"},{val:"20",text:"个人用户"},{val:"30",text:"个人认证用户"},{val:"40",text:"单位认证用户"},{val:"50",text:"（其它-例如学生)"}];lbs.settings.messages.cn.userStatus=[{val:"10",text:"审核中"},{val:"20",text:"正常"},{val:"30",text:"停止"}];}());lbs.routes['/basemodule']={mod:'lbs.basemodule',location:'/commons/js/util.js'};lbs.routes['/global:modal']={mod:'lbs.globalModal',location:'/commons/js/util.js'};lbs.routes['/comments']={mod:'lbs.comments',location:'/commons/js/util.js'};lbs.routes['/global:select:postal']={mod:'lbs.globalSelectPostal',location:'/commons/js/util.js'};lbs.routes['/global:photos:list']={mod:'lbs.globalPotosList',location:'/commons/js/util.js'};lbs.basemodule=lbs.modules['/basemodule']={pageComplete:function(arg){table_effects();slideEffectsHandler(arg);clearErrorMessage();jQuery('[data-toggle="popover"]').popover();jQuery('.dropdown.open .dropdown-toggle').dropdown('toggle');jQuery('.selectpicker').selectpicker({language:'zh_CN'});},render:function render(arg){var modalREg=function(){$('#modalReg').click(function(){console.log('clicked---');$('.modalLoginBox').addClass('hide');$('#popUpResgitration').removeClass('hide');});}
modalREg();jQuery(document).off('ajaxStop');return lbs.modHelper.returnResolved(arg);},deps:[],fillup:function fillup(list,pageSize,paddingBox){var add=pageSize-(list.length%pageSize),i=-1,ret=[];var emptyObj=paddingBox?{paddingBox:true}:{};add=(add===pageSize)?0:add;add=(list.length===0)?pageSize:add;add=list.length+add;while(++i<add){ret.push(list[i]||emptyObj);}return ret;},endPoints:{userInfo:'/home/user.json',logout:'/home/logout.json',login:'/home/login.json',register:'/home/registration.json',"profile:admin":'/workspace/profiles/v1/corporate/corporate.json',"profile:personal":'/workspace/profiles/v1/personal.json',"profile:corporate":'/workspace/profiles/v1/corporate/corporate.json'},remove:function(){},create:function(){var ua=window.navigator.userAgent.toLowerCase();if(ua.match(/MicroMessenger/i)=='micromessenger'){lbs.browsers.weixin=true;}var me=this;delete this.debs;delete this.create;},settings:null,'photo:list':{render:function render(arg){arg=arg||{};arg.queryData=arg.queryData||{p:0,ps:arg.pageSize||2};var me=this;var httpType=arg.httpType||'GET';this.otherHandlers=arg.handlers;this.forContainer=arg.container;this.currentView=arg.view||'galleryView';this.templateHelpers=arg.helpers||this.templateHelpers;this.pageSize=arg.queryData.ps
this.settings=arg.settings;var tmpArg={};tmpArg.list=[];tmpArg.withSpinner=true;var route=$.param.fragment()
var delim='/';var routeUrl=route.split(delim).slice(0,3);var module=routeUrl.join(delim);console.log('routUrl',routeUrl,'module',module);var listModArrr=['lbs',routeUrl[1],routeUrl[2],'list'];var listMod=lbs.util.getMember(window,listModArrr);lbs.currentListModList=this;lbs.currentListMod=module;lbs.currentListRoute=route;var searchText=jQuery("#searchtext");var searchStart=jQuery("#startdate");var searchEnd=jQuery("#enddate");if(searchText&&searchText.val())arg.queryData.sk=searchText.val();if(searchStart&&searchStart.val())arg.queryData.sd=searchStart.val();if(searchEnd&&searchEnd.val())arg.queryData.ed=searchEnd.val();this.rerender(tmpArg);return(arg.endPoint?lbs.modHelper.getMessage(arg.endPoint,false,arg.params,httpType,arg.queryData):jQuery.when({pl:me.list})).then(function(msg){if(arg.endPoint)me.endPoint=arg.endPoint;console.log('msg----',msg);if(arg.queryData){msg=receiveGetPageResponse(msg,arg.queryData.p,arg.queryData.ps);me.list=msg.pl;me.totalQueryResultCount=msg.mt.tc;}else{msg=receiveGetPageResponse(msg,0,10);me.list=msg.pl;me.totalQueryResultCount=null;}me.meta=msg.mt;me.meta.p=parseInt(me.meta.p);me.meta.ps=parseInt(me.meta.ps);me.updateArrows();return me.rerender(arg);});},rerender:function rerender(arg){console.log('------in rerender-----',arg);var me=this;arg=arg||{};var rowSize=arg.rowSize||4;return lbs.modHelper.getView(this.views[this.currentView]).then(function(view){var rand=Math.random();if(me.meta){if(arg==='singleview'){me.meta.ps=1;}else if(arg==='galleryView'){console.log('galery view------');me.meta.ps=20;}}lbs.modHelper.setContainer({mod:me,html:Mustache.render(view,{photostage:rand,list:lbs.basemodule.fillup(me.list.slice(me.index,me.index+me.pageSize),me.pageSize),total:me.meta?me.meta.tc:0,row:lbs.modHelper.isVal({obj:{ret:0},key:'ret',val:(function(pageSize,getIndex){return function(){var index=getIndex();if(index%rowSize===0&&index!==pageSize){return 0;}};}(me.pageSize,lbs.modHelper.index({index:1}))),yes:true,no:false}),page:lbs.modHelper.isVal({obj:{itemSize:true},key:'itemSize',val:(function(index,pageEnd){return function(){if(index()>pageEnd){return true;}};}(lbs.modHelper.index({index:me.index}),me.index+me.pageSize)),yes:false,no:true}),helpers:me.templateHelpers,activities:me.activities,settings:me.settings,date:lbs.util.renderDate,size:lbs.util.renderFileSizeInKB}),container:me.forContainer});if(arg&&arg.withSpinner){$('#idphotoGaleryContain').addClass('spinnerContainer');}lbs.actionHandler({container:me.forContainer,handlers:me.handlers});if(me.otherHandlers){lbs.actionHandler({container:me.forContainer,handlers:me.otherHandlers});}me.updateArrows();arg.noNeed=arg.noNeed||false;if(arg&&arg.withSpinning&&!arg.noNeed){console.log('with spinning-----');$('.spinnerPlaceHolder').addClass('spinnerContainerAbsolute');}else{if(me.meta&&me.meta.tc>0){arg.queryData=me.meta;}}});},movePage:function movePage(arg){arg=arg||{};var me=this;arg.endPoint=me.endPoint;var e=arg.e;var searchText=jQuery("#searchtext");var searchStart=jQuery("#startdate");var searchEnd=jQuery("#enddate");console.log("TRYING TO SET UP SEARCH, with elements","\nTEXT:",searchText.val(),"\nStart:",searchStart,"\nEnd:",searchEnd);if(searchText&&searchText.val())this.meta.sk=searchText.val();else this.meta.sk=undefined;if(searchStart&&searchStart.val())this.meta.sd=searchStart.val();else this.meta.sd=undefined;if(searchEnd&&searchEnd.val())this.meta.ed=searchEnd.val();else this.meta.ed=undefined;console.log("FROM",this.meta);if(e.currentTarget){var dirAttr=jQuery(e.currentTarget).attr('data-direction');if(dirAttr==='right')this.meta.p++;else if(dirAttr==='left')this.meta.p--;else this.meta.p=0;}this.meta.p=Math.min(Math.max(0,this.meta.p),Math.ceil(this.meta.tc/this.meta.ps));console.log("TO",this.meta);if(arg.e.target.getAttribute('data-view')==='single'){this.meta.ps=1;}arg.queryData=this.meta;var httpType=arg.httpType||'GET';console.log("MOVING PAGE",this.meta,arg);return(arg.endPoint?lbs.modHelper.getMessage(arg.endPoint,false,arg.params,httpType,arg.queryData):jQuery.when({pl:me.list})).then(function(msg){console.log('msg----',msg);if(arg.queryData){console.log('with arg------');msg=receiveGetPageResponse(msg,arg.queryData.p,arg.queryData.ps);me.list=msg.pl;me.totalQueryResultCount=msg.mt.tc;}else{msg=receiveGetPageResponse(msg,0,10);me.list=msg.pl;me.totalQueryResultCount=null;}me.meta=msg.mt;me.meta.p=parseInt(me.meta.p)
me.meta.ps=parseInt(me.meta.ps)
me.rerender(arg);});},updateArrows:function updateArrows(arg){var $container=jQuery(this.forContainer);if(this.meta&&this.meta.p===0){$container.find('.idPhotoGaleryArrowContainerLeft').addClass('disabled');$container.find('.idPhotoGaleryArrow.left').addClass('disabled');}else{$container.find('.idPhotoGaleryArrowContainerLeft').removeClass('disabled');$container.find('.idPhotoGaleryArrow.left').removeClass('disabled');}if(this.meta&&(((this.meta.p*this.meta.ps)>=(this.meta.tc-1))||(this.meta.ps>this.meta.tc))){$container.find('.idPhotoGaleryArrowContainerRight').addClass('disabled');$container.find('.idPhotoGaleryArrow.right').addClass('disabled');}else{$container.find('.idPhotoGaleryArrowContainerRight').removeClass('disabled');$container.find('.idPhotoGaleryArrow.right').removeClass('disabled');}},setSelectedMode:function setSelectedMode(arg){arg=arg||{};var e=arg.e;var $this=jQuery(e.currentTarget);if($this.prop('class').indexOf('Clicked')!==-1){return;}$this.parents('.inspectionDisplyModes').find('div').each(function(){var $this=jQuery(this),classes=$this.prop('class').split(' '),i=-1,len=classes.length;while(++i<len){if(classes[i].indexOf('Clicked')!==-1){$this.removeClass(classes[i]);}}});$this.addClass($this.prop('class')+'Clicked');}},'general:list':{render:function(arg){var me=this;arg=arg||{};var httpType=arg.httpType||'GET';me.viewUrl=arg.listView||me.viewUrl;me.containerToSet=arg.container;var tmpArg={};arg.queryData=arg.queryData||{p:0,ps:10,tc:10};var searchText=jQuery("#searchtext");var searchStart=jQuery("#startdate");var searchEnd=jQuery("#enddate");if(searchText&&searchText.val())arg.queryData.sk=searchText.val();if(searchStart&&searchStart.val())arg.queryData.sd=searchStart.val();if(searchEnd&&searchEnd.val())arg.queryData.ed=searchEnd.val();var route=$.param.fragment();var delim='/';var routeUrl=route.split(delim).slice(0,3);var module=routeUrl.join(delim);console.log('routUrl',routeUrl,'module',module);var listModArrr=['lbs',routeUrl[1],routeUrl[2],'list'];var publishingRoute=/\/workspace\/publishing\/activities\//;var listMod=null;if(publishingRoute.test(route)){listMod=lbs['workspace:nomenu'].publishing['activities:select:service'].serviceList;}else{listMod=lbs.util.getMember(window,listModArrr);}lbs.currentListModList=listMod;lbs.currentListMod=module;lbs.currentListRoute=route;var listquery={};if(lbs.modules[lbs.currentListMod]&&lbs.modules[lbs.currentListMod].routeParams&&lbs.modules[lbs.currentListMod].routeParams[lbs.currentListRoute]&&lbs.modules[lbs.currentListMod].routeParams[lbs.currentListRoute].query){listquery=lbs.modules[lbs.currentListMod].routeParams[lbs.currentListRoute].query;}lbs.util.merge(listquery,arg.queryData)
console.log('listMod ---------',lbs.currentListModList);console.log('mergedquery---------',arg.queryData);tmpArg.withSpinning=true;this.rerender(tmpArg);return(arg.listEndPoint?lbs.modHelper.getMessage(arg.listEndPoint,false,arg.params,httpType,arg.queryData):jQuery.when({pl:me.list})).then(function(msg){console.log('msg----',msg);if(arg.queryData){msg=receiveGetPageResponse(msg,arg.queryData.p,arg.queryData.ps);me.list=msg.pl;me.totalQueryResultCount=msg.mt.tc;}else{msg=receiveGetPageResponse(msg,0,10);me.list=msg.pl;me.totalQueryResultCount=null;}me.meta=msg.mt;me.meta.p=parseInt(me.meta.p)
me.meta.ps=parseInt(me.meta.ps)
return me.rerender(arg);});},rerender:function rerender(arg){var me=this;arg=arg||{};me.viewUrl=arg.listView||me.viewUrl;return lbs.modHelper.getView(me.viewUrl).then(function(view){var data;var itemsHolder=[];if(arg.withPadding===false){itemsHolder=me.list;}else if(arg.specialPadding){itemsHolder=lbs.basemodule.fillup(me.list.slice(me.index,me.index+me.pageSize),me.pageSize,true);}else{itemsHolder=lbs.basemodule.fillup(me.list.slice(me.index,me.index+me.pageSize),me.pageSize);}data={items:itemsHolder,date:lbs.util.renderDate,totalItems:me.totalQueryResultCount,dateTime:lbs.util.renderDateTime,renderActivityTypes:lbs.util.renderActivityTypes,renderServiceStatus:lbs.util.renderServiceStatus};if(arg&&arg.extraData){data.extraData=arg.extraData;}lbs.util.merge(arg,data);lbs.modHelper.setContainer({mod:me,html:Mustache.render(view,data),container:me.containerToSet});arg.noNeed=arg.noNeed||false;if(arg&&arg.withSpinning&&!arg.noNeed){console.log('with spinning-----');$('.spinnerPlaceHolder').addClass('spinnerContainerAbsolute');}else{console.log('without spinning-----',me);if(me.meta&&me.meta.tc>0){arg.queryData=me.meta;console.log('calling pagination-----',arg.queryData);if(arg.listView=="/processes/activities/activitieslist.html")lbs.modules['/pagination'].create('.processes_activitieslist','.activities_container_bottom');else if(arg.listView=="/workspace/publishing/servicelist.html"){lbs.modules['/pagination'].create('.serviceSelectionTable1');}else
lbs.modules['/pagination'].create();lbs.modules['/pagination'].render(arg);}}});},parentRender:function(arg){arg=arg||{};var d=arg.defer||jQuery.Deferred();var me=this;var route=jQuery.param.fragment();var parentRender=(this.parent&&typeof this.parent.render==='function')?this.parent.render(arg):jQuery.when();var parentContainer=me.container||arg.data.parentContainer;parentRender.then(function(){return jQuery.when((arg.listMod)?lbs.modHelper.getMod(arg.listMod):null,lbs.modHelper.getView(arg.mainView));}).then(function(listMod,view){var data=(me.routeParams&&me.routeParams[route])?me.routeParams[route]:{};lbs.util.merge(arg.data,data);lbs.modHelper.setContainer({mod:me,html:Mustache.render(view,data),container:parentContainer});return(listMod)?listMod.render(data):null;}).then(function(res){lbs.actionHandler({container:parentContainer,handlers:me.handlers});d.resolve();});return d.promise();},deleteEntity:function deleteEntity(arg){var entity,index=lbs.util.find({arr:arg.listMod.list,key:'_id',val:arg._id});var container='#platformAPIsModal';entity=arg.listMod.list[index];return lbs.modHelper.getView('/workspace/confirm.html').then(function(view){lbs.modHelper.setContainer({container:container,mod:{},html:Mustache.render(view,{entityName:arg.type,code:arg.code?lbs.util.getMember(entity,arg.code.split('.')):'',name:arg.name?lbs.util.getMember(entity,arg.name.split('.')):''})});lbs.actionHandler({handlers:{'entity:delete:confirmed':function(e){var pl={pl:{}};pl.pl[arg.entityName]={_id:arg._id,ds:true};lbs.modHelper.getMessage(arg.updateEndpoint,false,{},'PUT',{json:JSON.stringify(pl)}).then(function(){arg.listMod.removeItem(arg._id);jQuery(container).modal('hide');});}},container:container});jQuery(container).modal();});}},'general:modal:list':{render:function(arg){var me=this;arg=arg||{};var httpType=arg.httpType||'GET';me.viewUrl=arg.listView||me.viewUrl;me.containerToSet=arg.container;var tmpArg={};return(arg.listEndPoint?lbs.modHelper.getMessage(arg.listEndPoint,false,arg.params,httpType,arg.queryData):jQuery.when({pl:me.modalList})).then(function(msg){console.log('modal msg----',msg);if(arg.queryData){me.modalList=msg.pl;me.modalListTotalQueryResultCount=msg.mt.tc;}else{me.modalList=msg.pl;me.modalListTotalQueryResultCount=null;}me.modalListMeta=msg.mt;me.modalListMeta.p=parseInt(me.modalListMeta.p)
me.modalListMeta.ps=parseInt(me.modalListMeta.ps)
return me.rerender(arg);});},rerender:function rerender(arg){var me=this;arg=arg||{};me.viewUrl=arg.listView||me.viewUrl;return lbs.modHelper.getView(me.viewUrl).then(function(view){var data;data={items:me.modalList,date:lbs.util.renderDate,totalItems:me.modalListTotalQueryResultCount,dateTime:lbs.util.renderDateTime,renderActivityTypes:lbs.util.renderActivityTypes,renderServiceStatus:lbs.util.renderServiceStatus};if(arg&&arg.extraData){data.extraData=arg.extraData;}lbs.util.merge(arg,data);lbs.modHelper.setContainer({mod:me,html:Mustache.render(view,data),container:me.containerToSet});});}},confirmAction:function confirmAction(arg){var container=arg.container;return lbs.modHelper.getView('/commons/views/confirmAction.html').then(function(view){lbs.modHelper.setContainer({container:container,html:Mustache.render(view,{data:arg})});jQuery(container).modal();})},handlers:{}};lbs.modules['/global:modal']={deps:[],createdBy:false,myContainer:'',persist:false,create:function create(){lbs.globalModal=this;delete this.deps;delete this.create;},hide:function hide(){jQuery(this.myContainer).off('hide.bs.modal.globalmod');jQuery(this.myContainer).modal('hide');},render:function render(arg){console.log('modal render----');arg=arg||{};var d=arg.defer||jQuery.Deferred();var me=this;me.myContainer=arg.container;me.persist=arg.persist||false;this.createdBy=arg.createdBy;lbs.modHelper.getView('/commons/views/modal.html').then(function(view){lbs.modHelper.setContainer({mod:me,html:Mustache.render(view,view),container:arg.container});jQuery(arg.container).modal();if(me.persist){jQuery(me.myContainer).on('hide.bs.modal.globalmod',function(e){e.preventDefault();});}return arg.view?lbs.modHelper.getView(arg.view):false;}).then(function(view){if(view){lbs.modHelper.setContainer({mod:me,html:Mustache.render(view,arg.templateData),container:arg.container});}d.resolve();});return d.promise();},remove:function remove(){if(this.createdBy&&(typeof this.createdBy==='function')){this.createdBy.remove();}}};lbs.modules['/global:select:postal']=(function(){var Postal=function(){var me=this;this.binders=[];this.values=[];this.renderIn='';this.regions='';this.view='';this.changeListener=false;this.handlers={};this.handlers["postal:online"]=function online(e){jQuery(me.renderIn).find('.postal-pysical').addClass('hide');};this.handlers["postal:physical"]=function physical(e){jQuery(me.renderIn).find('.postal-pysical').removeClass('hide');};};Postal.prototype.resetValues=function resetValues(){this.values=[];};Postal.prototype.deps=[];Postal.prototype.create=function create(){lbs.globalSelectPostal=Postal;delete Postal.deps;delete Postal.create;};Postal.prototype.setValueFromValue=function setValueFromValue(val){var index,tmpVal=Object.prototype.toString.call(val).indexOf('Array')===-1?[val.toString()]:val,$province=jQuery(this.renderIn).find(this.cssSelectDropdowns[2]),$city,$region;if(!val||!tmpVal[0]){return;}$province.val(val);if(!$province.val()){$province.val(tmpVal[0].substr(0,2)+'0000');}if(!$province.val()){return;}$province.trigger('change');$city=jQuery(this.renderIn).find(this.cssSelectDropdowns[1]);$city.val(val);if(!$city.val()){$city.val(tmpVal[0].substr(0,4)+'00');if(!$city.val()){$city.val(tmpVal[0].substr(0,2)+'0000');}}if(!$city.val()){return;}$city.trigger('change');$region=jQuery(this.renderIn).find(this.cssSelectDropdowns[0]);$region.val(val);if(!$region.val()){return;}$region.trigger('change');};Postal.prototype.setValue=function setValue(val){var $radio;var $province=jQuery(this.renderIn).find(this.cssSelectDropdowns[2]),$city,$region;if(val){return this.setValueFromValue(val);}if(this.values[0]){$province.val(this.values[0]);$province.trigger('change');}if(this.values[1]){$city=jQuery(this.renderIn).find(this.cssSelectDropdowns[1]);$city.val(this.values[1]);$city.trigger('change');}if(this.values[2]){$region=jQuery(this.renderIn).find(this.cssSelectDropdowns[0]);$region.val(this.values[2]);$region.trigger('change');jQuery(this.renderIn).find('.selectpicker').selectpicker('refresh');}if(val==='online'){$radio=jQuery(this.renderIn).find("[data-action-change|='postal:online']");$radio.prop('checked',true);$radio.trigger('change');}};Postal.prototype.cssSelectDropdowns=['select.regions','select.cities','select.provinces'];Postal.prototype.resetDropdownValues=function resetDropdownValues(index){var enable=3;while(--enable>=index){jQuery(this.renderIn).find(this.cssSelectDropdowns[index]).prop('disabled',false);}while(--index>-1){jQuery(this.renderIn).find(this.cssSelectDropdowns[index]).html('');jQuery(this.renderIn).find(this.cssSelectDropdowns[index]).prop('disabled',true);}};Postal.prototype.setProvince=function setProvince(){var i=-1,len=this.regions.length,$provinces=jQuery(this.renderIn).find('select.provinces'),options=["<option></option>"],me=this;if($provinces.prop('multiple')){options=[];}while(++i<len){options.push("<option value='");options.push(this.regions[i]['省及直辖市代码']);options.push("'>");options.push(this.regions[i]['省及直辖市']);options.push("</option>");}$provinces.html(options.join(''));this.resetDropdownValues(2);$provinces.off('change.postalwatch');$provinces.on('change.postalwatch',function(e){me.values[0]=jQuery(e.target).val();me.setCity(e);});};Postal.prototype.setCity=function setCity(e){var val=jQuery(e.target).val();if(val&&val.length>1&&Object.prototype.toString.call(val).indexOf('Array')!==-1){this.resetDropdownValues(2);jQuery(this.renderIn).find('.selectpicker').selectpicker('refresh');return;}var index=lbs.util.find({key:'省及直辖市代码',val:e.target.value,arr:this.regions});var arr=[];if(this.regions[index]){arr=this.regions[index]['市'];}var i=-1,len=arr.length,$cities=jQuery(this.renderIn).find('select.cities'),options=["<option></option>"],me=this;if($cities.prop('multiple')){options=[];}while(++i<len){options.push("<option value='");options.push(arr[i]['市代码']);options.push("'>");options.push(arr[i]['省辖市']);options.push("</option>");}$cities.html(options.join(''));this.resetDropdownValues(1);$cities.off('change.postalwatch');$cities.on('change.postalwatch',function(e){me.values[1]=jQuery(e.target).val();me.setRegion(e,arr);});jQuery(this.renderIn).find('.selectpicker').selectpicker('refresh');};Postal.prototype.setRegion=function setRegion(e,cities){var val=jQuery(e.target).val();if(val&&val.length>1&&Object.prototype.toString.call(val).indexOf('Array')!==-1){this.resetDropdownValues(1);jQuery(this.renderIn).find('.selectpicker').selectpicker('refresh');return;}var index=lbs.util.find({key:'市代码',val:e.target.value,arr:cities});var arr=[];if(cities[index]){arr=cities[index]['区县'];}var i=-1,len=arr.length,$regions=jQuery(this.renderIn).find('select.regions'),options=["<option></option>"],me=this;if($regions.prop('multiple')){options=[];}while(++i<len){options.push("<option value='");options.push(arr[i]['区县代码']);options.push("'>");options.push(arr[i]['市辖区县']);options.push("</option>");}this.resetDropdownValues(0);$regions.html(options.join(''));$regions.off('change.postalwatch');$regions.on('change.postalwatch',function(e){me.values[2]=jQuery(e.target).val();});jQuery(this.renderIn).find('.selectpicker').selectpicker('refresh');};Postal.prototype.render=function render(arg){var me=this;me.changeListener=arg.changeListener||false;this.renderIn=arg.container;return jQuery.when(lbs.modHelper.getView(arg.view),lbs.modHelper.getMessage('/commons/js/china_regions.js',true)).then(function(view,regions){me.view=view;me.regions=JSON.parse(regions);return me;}).then(function(){lbs.modHelper.setContainer({mod:me,html:Mustache.render(me.view,{boundKey:arg.key}),container:me.renderIn});me.setProvince();lbs.actionHandler({handlers:me.handlers,container:me.renderIn});me.setValue(arg.boundTo[arg.key]);me.binders=lbs.binder.bind(me.renderIn,arg.boundTo,'postal-code-entity',[function(obj,key,root,path){var val;if(me.changeListener&&typeof me.changeListener==='function'){me.changeListener(obj,key,root,path);}if(obj[key]===undefined||obj[key]===null){return;}if(obj[key]==='online'){return;}val=(obj[key].join)?obj[key].join():obj[key];jQuery(me.renderIn).find('.postalcode-pysical-radio').val(val);if(val.indexOf(',')!==-1){obj[key]=val.split(',');}}]);lbs.binder.cancelUpdateObject(me.binders);});};Postal.prototype.remove=function remove(){lbs.binder.unbind(this.binders);};return Postal;}());lbs.modules['/global:photos:list']={deps:[],views:{galleryView:'/workspace/profile/chooseProfilePicture.html',listView:'/workspace/photos/listView.html'},endpoints:{'idphoto':'/workspace/profiles/v1/idphotos.json'},currentView:null,list:[],otherHandlers:false,index:0,totalRecords:null,pageSize:8,boundValues:[],selectedPhoto:null,currentEndpoint:null,templateHelpers:{},create:function create(){var me=this;this.handlers['profile:photos:list:movePage']=function(e){me.movePage(e);};this.handlers['profile:photos:list:switch']=function(e){me.switchEndPoint(e);};this.handlers['profile:save:selected:photo:basic']=function(e){};lbs.globalPotosList=this;delete this.deps;delete this.create;},render:function render(arg){arg=arg||{};var container=jQuery('<div aria-hidden="true" role="dialog" tabindex="-1" class="modal stripped_modal" style="display: none;"></div>');jQuery(body).append(container);this.modalContainer=container;arg.container=container;arg.endPoint=arg.endPoint||this.endpoints[this.currentEndpoint]||this.endpoints.idphoto;lbs.basemodule['photo:list'].render.call(this,arg);},rerender:function rerender(){var me=this;this.templateHelpers.isSelected=lbs.modHelper.isChecked([me.selectedPhoto],'_id');this.templateHelpers.photoTypeSelected=function(){return function(text){if(!me.currentEndpoint&&text==='idphoto'){return'checked=""';}if(me.currentEndpoint===text){return'checked=""';}return'';};}
lbs.binder.unbind(me.boundValues);lbs.basemodule['photo:list'].rerender.call(this).then(function(){me.boundValues=lbs.binder.bind(me.modalContainer,me,'profile');me.forContainer.modal('show').on('hidden.bs.modal',function(){me.remove();})})},movePage:function movePage(e){lbs.basemodule['photo:list'].movePage.call(this,{e:e});},switchEndPoint:function switchEndPoint(e){var ep=e.target.getAttribute('data-endpoint');if(this.currentEndpoint===ep){return;}this.currentEndpoint=ep;this.render({endPoint:this.endpoints[ep],container:this.modalContainer,handlers:this.handlers,settings:{showSwichType:true,action:{saveBasic:true,savePrivate:false}}});},updateArrows:function updateArrows(){lbs.basemodule['photo:list'].updateArrows.call(this);},handlers:{},remove:function remove(){var me=this;lbs.binder.unbind(me.boundValues);this.forContainer&&this.forContainer.remove();}};lbs.comments=lbs.modules['/comments']={commentsEndpoint:'/workspace/notifications/comments/',maintemplate:'/details/comments/comments.html',newtemplate:'/details/comments/new.html',container:'#commentSectionContainer',newComment:'#newCommentText',replyComment:'#replyCommentText',tID:null,commentSubject:{},cguid:null,ln:null,message:{},commentsContainer:'#commentContainerBoxBoby',newCommentUri:'/workspace/notifications/comments/comment.json',userEnpoint:'workspace/profiles/v1/personal.json',user:null,comments:null,create:function(){var me=this;this.handlers['comments:reply:to:specific:user']=function(e){me.cguid=e.target.getAttribute('data-id');me.ln=e.target.getAttribute('data-user');me.handleReplyToComment(e);};this.handlers['comments:new:submit']=function(e){me.handleNewComment(e);};this.handlers['comments:reply:to:specific:user:submit']=function(e){me.handleSubmitReplyToComment(e);};this.handlers['comment:like']=function(e){me.cguid=e.target.getAttribute('data-id');me.markAsLiked(e);};this.handlers['comment:inmail:send']=function(e){var user=e.target.getAttribute('data-user');var subject=e.target.getAttribute('data-subject');me.sendInmailFromComment({e:e,user:user,subject:subject});};this.handlers['send:inmail:message']=function(e){me.notificationSentSuccessful(e);};this.handlers['comments:detele']=function(e){var id=e.target.getAttribute('data-id');var domEl=jQuery(e.target).closest('.media-list');me.deleteComment({e:e,_id:id,entityName:'comment',domEl:domEl});};lbs.comments=this;delete this.deps;delete this.create;},deps:[],render:function render(arg){var me=this;me.commentSubject=arg.acid;me.tID=arg.acid.abd.ac;return jQuery.when(lbs.modHelper.getView(me.maintemplate),lbs.modHelper.getMessage(me.commentsEndpoint+me.tID+'.json',false,false,'GET'),(lbs.user)?lbs.modHelper.getMessage(me.userEnpoint,false,false,'GET'):{pl:null}).then(function(view,comment,user){me.user=user.pl;me.comments=comment.pl;lbs.modHelper.setContainer({mod:me,html:Mustache.render(view,{data:me.comments,info:me.commentSubject,date:lbs.util.renderDateTime}),container:me.container});lbs.actionHandler({container:me.container,handlers:me.handlers});lbs.basemodule.pageComplete();});},handleNewComment:function handleNewComment(e){var me=this;var comment={};comment.cc=jQuery(me.newComment).val();if(comment.cc){comment.tguid=me.tID;comment.av=me.user.basic.avatar.value;comment.ln=lbs.user.loginName;lbs.modHelper.getMessage(me.newCommentUri,false,false,'POST',comment).then(function(response){if(response.pl){var latest=response.pl;me.comments.push(latest);lbs.modHelper.getView(me.newtemplate).then(function(view){var $html=jQuery(Mustache.render(view,{data:latest,info:me.commentSubject,date:lbs.util.renderDateTime}));jQuery(me.commentsContainer).prepend($html);lbs.actionHandler({container:$html,handlers:me.handlers});});jQuery(me.newComment).val('');}else{alert('操作失败！请重试');}});}},handleReplyToComment:function handleReplyToComment(e){var me=this;jQuery(me.replyComment).prop('placeholder','回复'+'@'+me.ln+'........');lbs.util.showItem('#commentReplyBoxId');},handleSubmitReplyToComment:function handleSubmitReplyToComment(e){var me=this;var comment={};comment.cc='@'+me.ln+' '+jQuery(me.replyComment).val();if(comment.cc){comment.tguid=me.tID;comment.av=me.user.basic.avatar.value;comment.ln=lbs.user.loginName;comment.pc={pc:true,cguid:me.cguid,ln:me.ln};me.cguid=null;me.ln=null;lbs.modHelper.getMessage(me.newCommentUri,false,false,'POST',comment).then(function(response){if(response.pl){var latest=response.pl;me.comments.push(latest);lbs.modHelper.getView(me.newtemplate).then(function(view){var $html=jQuery(Mustache.render(view,{data:latest,date:lbs.util.renderDateTime}));jQuery(me.commentsContainer).prepend($html);lbs.actionHandler({container:$html,handlers:me.handlers});});lbs.util.hideItem('#commentReplyBoxId');jQuery(me.replyComment).val('');}else{alert('操作失败！请重试');}});}},markAsLiked:function markAsLiked(e){var me=this;var el=jQuery(e.target);var index=lbs.util.find({arr:me.comments,key:'_id',val:me.cguid});me.comments[index].vc=me.comments[index].vc+1;var comment=me.comments[index];if(comment){lbs.modHelper.getMessage(me.commentsEndpoint+'comments/'+me.cguid+'.json',false,false,'PUT',comment).then(function(response){var latest=response.pl;if(latest){el.addClass('specialBlue');el.next('.numberOfLikes').text(comment.vc);}else{me.comments[index].vc=me.comments[index].vc-1;alert('操作失败！请重试');}});}},deleteComment:function deleteComment(arg){var me=this;var entity,index=lbs.util.find({arr:me.comments,key:'_id',val:arg._id});var container='#platformAPIsModal';entity=me.comments[index];return lbs.modHelper.getView('/workspace/confirm.html').then(function(view){lbs.modHelper.setContainer({container:container,mod:{},html:Mustache.render(view,{entityName:'评论'})});lbs.actionHandler({handlers:{'entity:delete:confirmed':function(e){var pl={pl:{}};pl.pl[arg.entityName]={_id:arg._id,ln:entity.ln,ds:true};lbs.modHelper.getMessage(me.commentsEndpoint+arg._id+'.json',false,{},'DELETE',{json:JSON.stringify(pl)}).then(function(){arg.domEl.remove();me.comments.splice(index,1);jQuery(container).modal('hide');});}},container:container});jQuery(container).modal();});},sendInmailFromComment:function sendInmailFromComment(arg){var me=this;lbs.modHelper.getView('/workspace/notifications/sendInmail.html').then(function(view){lbs.modHelper.setContainer({container:'#platformAPIsModal',html:Mustache.render(view)});lbs.actionHandler({container:'#platformAPIsModal',handlers:me.handlers});jQuery('#notificationReceivers').val(arg.user);jQuery('#notificationSubject').val(arg.subject);jQuery('#notificationReceivers').prop('readonly',true);jQuery('#notificationSubject').prop('readonly',true);jQuery('#platformAPIsModal').modal().off('hide.bs.modal.sendInmail');jQuery('#platformAPIsModal').modal().on('hide.bs.modal.sendInmail',function(){lbs.modHelper.setContainer({container:'#plaformAPIsModal',html:''});});});},notificationSentSuccessful:function notificationSentSuccessful(e){var value;var me=this;me.message.notification={};me.message.recipients=jQuery('#notificationMessageForm #notificationReceivers').val().replace(/\s+/g,'').split(';');me.message.notification.subject=jQuery('#notificationMessageForm #notificationSubject').val();me.message.notification.body=jQuery('#notificationMessageForm #notificationBody').val();me.message.notification.notificationType='业务通知';for(value in me.message.recipients){me.message.recipients[value]={'to':me.message.recipients[value]};}lbs.modHelper.getView('/workspace/notifications/spinningStransitionPage.html').then(function(view){lbs.modHelper.setContainer({container:'#platformAPIsModal',html:view});});lbs.modHelper.getMessage('/workspace/notifications/mailling/notifications.json',null,{modalToHide:'#platformAPIsModal'},'POST',me.message).then(function(msg){lbs.modHelper.getView('/workspace/notifications/operationSuccessfull.html').then(function(view){lbs.modHelper.setContainer({container:'#platformAPIsModal',html:view});countDown(function(){jQuery('#platformAPIsModal').modal('hide');lbs.modHelper.setContainer({container:'#plaformAPIsModal',html:''});});});});},handlers:{}};lbs.pagination=lbs.modules['/pagination']={view:'/commons/views/pagination.html',container:'.paginationContainer',create:function(target,search){console.log("CREATING PAGINATIoN");var me=this;if(target===undefined)target='.container_bottom';if(search===undefined)search='.container_top';this.handlers['pagination:change:page']=function(e){var page=e.target.getAttribute('data-page');var endpoints=lbs.modules[lbs.currentListMod].routeParams[lbs.currentListRoute]?lbs.modules[lbs.currentListMod].routeParams[lbs.currentListRoute].listEndPoint:lbs.modules[lbs.currentListMod].routeParams.listEndPoint;console.log('endpoints----',endpoints);console.log('page---',page);lbs.currentListModList.render({pagination:true,page:page,listEndPoint:endpoints,container:target,queryData:{p:page,ps:lbs.currentListModList.pageSize}});};this.searchHandlers['pagination:search']=function(e){e.preventDefault();var page=0
var endpoints=lbs.modules[lbs.currentListMod].routeParams[lbs.currentListRoute]?lbs.modules[lbs.currentListMod].routeParams[lbs.currentListRoute].listEndPoint:lbs.modules[lbs.currentListMod].routeParams.listEndPoint;lbs.currentListModList.render({pagination:true,page:page,listEndPoint:endpoints,container:target,queryData:{p:page,ps:lbs.currentListModList.pageSize}});}
lbs.pagination=this;lbs.actionHandler({container:search,handlers:me.searchHandlers,doOverride:true})},render:function render(arg){var me=this;var meta=arg.queryData?arg.queryData:{p:0,ps:10,tc:null};console.log('pagination render meta---',meta);var pages=calculatePaginationElements(meta.tc,meta.p,meta.ps).map(function(ele){return ele;})
var isCurrent=calculatePaginationElements(meta.tc,meta.p,meta.ps).filter(function(ele){return ele.current});if(isCurrent.length==0){var next=0;var prev=0;var currentPageNumber=0;}else{var next=isCurrent[0].p+1;var prev=isCurrent[0].p-1;var currentPageNumber=isCurrent[0].label*lbs.currentListModList.pageSize;}var totalPageNumber=totalPageNumber===NaN||!currentPageNumber?null:lbs.currentListModList.totalQueryResultCount;var showNext=next<(meta.tc/meta.ps);var showPrev=prev>=0;lbs.modHelper.getView(me.view).then(function(view){lbs.modHelper.setContainer({html:Mustache.render(view,{pages:pages,prevPage:prev,nextPage:next,showNext:showNext,showPrev:showPrev,current:currentPageNumber,total:totalPageNumber}),container:me.container});lbs.actionHandler({container:me.container,handlers:me.handlers})})},handlers:{},searchHandlers:{}};lbs.globalHandlers={bbqUpdate:function bbqUpdate(e,url){var script_source_url;if(e){script_source_url=e.currentTarget.getAttribute('data-linkto');e.preventDefault();}else{script_source_url=url;}if(script_source_url==="/home"){jQuery.bbq.pushState('#');}else if(script_source_url==="/workspace/welcome"){jQuery.bbq.pushState('#'+'/workspace/welcome');}else{jQuery.bbq.pushState('#'+script_source_url);}}};lbs.actionHandler=function(arg){var container=arg.container,handlers=arg.handlers,doOverride=arg.doOverride,$container;if(container.constructor===jQuery){$container=container;}else{$container=jQuery(container);}var handler=function(attr){return function(e){var action=e.currentTarget.getAttribute(attr);action=action||'';action=action.split(',');var i=-1,len=action.length;while(++i<len){if(typeof handlers[action[i]]==='function'){handlers[action[i]](e);}}};};if(doOverride){$container.find("#financesearch").off('click');}$container.find("[data-action-click]").on('click',handler('data-action-click'));$container.find("[data-action-change]").on('change',handler('data-action-change'));$container.find("[data-action-hover]").hover(handler('data-action-hover'));};lbs.binder={BoundValue:(function(){var BoundValue=function(arg){this.element=arg.element;this.toMutate=arg.toMutate;this.objToMutate=arg.objToMutate;this.root=arg.root;this.path=arg.path;this.changeListeners=arg.changeListeners||[];this.formatters=arg.formatters||{};var me=this;jQuery(this.element).on('change',function(e){me.change(e);});this.initialBind=setTimeout(function(){me.change({target:me.element});},250);};var BoundList=function BoundList(arg){BoundValue.call(this,arg);};var PhotoUploadBoundValue=function PhotoUploadBoundValue(arg){var me=this;var plist;BoundValue.call(this,arg);clearTimeout(this.initialBind);lbs.actionHandler({container:jQuery(this.element),handlers:{"activity:response:upload:image:platform":function(e){e.preventDefault();lbs.modHelper.getMod('/global:photos:list').then(function(photoList){photoList.handlers['profile:save:selected:photo:basic']=function(e){var arr=photoList.list;photoList.selectedPhoto=parseInt(photoList.selectedPhoto,10);var index=lbs.util.find({arr:arr,key:'_id',val:photoList.selectedPhoto});if(index!==-1){me.objToMutate[me.toMutate]=photoList.list[index];jQuery(me.element).find('img').prop('src',photoList.list[index].photourl);jQuery(me.element).trigger('change');}}
return photoList.render({settings:{hideOther:true,action:{saveBasic:true}}})});},"activity:response:upload:image:local":function(e){e.preventDefault();me.uploadPhoto(e);}}});jQuery(this.element).find('img').on('load',function(e){var tmp=jQuery('<img >');tmp.on('load',function(e){var orgh=e.target.height;var orgw=e.target.width;var tarh=200;var tarw=150;var wanth,wantw;if((orgw/orgh)<(tarw/tarh)){wanth=tarh+'px';wantw=Math.floor(orgw*(tarh/orgh))+'px';}else{wantw=tarw+'px';wanth=Math.floor(orgh*(tarw/orgw))+'px';}console.log(wanth,wantw,'strrrange')
jQuery(me.element).find('img').css({width:wantw,height:wanth});})
tmp.prop('src',e.target.src);})
if(!lbs.user){jQuery(this.element).find('div.response_form_choose_photo').hide();}};var InnerHtmlBinder=function InnerHtmlBinder(arg){BoundValue.call(this,arg);};BoundValue.create=function(arg){if(arg.element.type==='checkbox'&&(Object.prototype.toString.call(arg.objToMutate[arg.toMutate]).indexOf('Array')!==-1)){return new BoundList(arg);}if(arg.element.tagName.toLowerCase()==='span'){return new InnerHtmlBinder(arg);}if(arg.element.tagName.toLowerCase()==='div'&&arg.element.getAttribute('data-photo-standard')){return new PhotoUploadBoundValue(arg);}return new BoundValue(arg);};BoundValue.prototype.change=function(e){if(e&&e.target&&e.target.type==='radio'){if(!e.target.checked){return;}}if(this.element.type==='checkbox'&&(Object.prototype.toString.call(this.objToMutate[this.toMutate]).indexOf('Array')===-1)){this.objToMutate[this.toMutate]=this.element.checked;}else{this.objToMutate[this.toMutate]=jQuery(e.target).val();}this.emitChange();};BoundValue.prototype.emitChange=function emitChange(){var i=this.changeListeners.length;while(--i>-1){this.changeListeners[i](this.objToMutate,this.toMutate,this.root,this.path,this.element);}};BoundValue.prototype.cancelUpdateObject=function cancelUpdateObject(){clearTimeout(this.initialBind);};BoundValue.prototype.updateUI=function updateUI(){clearTimeout(this.initialBind);var val=this.objToMutate[this.toMutate];if(this.formatters[this.path.join('.')]){val=this.formatters[this.path.join('.')](val);}if(this.element.tagName==='SELECT'){lbs.util.setSelect(this.element,this.objToMutate[this.toMutate]);}if(this.element.type==='radio'){this.element.checked=(this.objToMutate[this.toMutate]===this.element.value);return;}if(this.element.type==='checkbox'&&(Object.prototype.toString.call(this.objToMutate[this.toMutate]).indexOf('Array')===-1)){this.element.checked=!!this.objToMutate[this.toMutate];return;}jQuery(this.element).val(val);};BoundValue.prototype.destroy=function(){jQuery(this.element).off();};BoundList.prototype=Object.create(BoundValue.prototype);BoundList.prototype.constructor=BoundList;BoundList.prototype.change=function(e){var index;if(e.target.checked){this.objToMutate[this.toMutate].push(e.target.value);}else{index=this.objToMutate[this.toMutate].indexOf(e.target.value);if(index!==-1){this.objToMutate[this.toMutate].splice(index,1);}}this.emitChange();};PhotoUploadBoundValue.prototype=Object.create(BoundValue.prototype);PhotoUploadBoundValue.prototype.constructor=PhotoUploadBoundValue;PhotoUploadBoundValue.prototype.destroy=function destroy(){}
PhotoUploadBoundValue.prototype.updateUI=function updateUI(){var uri=lbs.util.getMember(this.root,this.path.concat(['uri']));jQuery(this.element).find('img').prop('src',uri);}
PhotoUploadBoundValue.prototype.uploadPhoto=function uploadPhoto(e){var me=this;console.log('uploading photos-----');console.log('e.target.getAttribute("data-id")----',e.target.getAttribute("data-id"));console.log('e.target-------------',e.target);var targetPHotoPlaceHolder=$(e.target).closest('.imageWrapper').find('#spinnerPlaceHolder');console.log('targetPHotoPlaceHolder',targetPHotoPlaceHolder);targetPHotoPlaceHolder.addClass('spinnerContainer');var ac=lbs.processes.activities.application.dbResponse.acn;var rc=lbs.processes.activities.application.dbResponse.rc;var ow=lbs.processes.activities.application.dbResponse.ow;var can=lbs.processes.activities.application.dbResponse.can;var cat=lbs.processes.activities.application.dbResponse.cat;var tpp=lbs.processes.activities.application.dbActivity.fm.fd.pt[0].pp;var input=jQuery(e.target),numFiles=input.get(0).files?input.get(0).files.length:1,label=input.val().replace(/\\/g,'/').replace(/.*\//,'');if(jQuery(e.target)[0].files[0]){var reader=new FileReader();reader.onload=function(e){var oldSrc=jQuery(me.element).find('img').attr('src');jQuery(me.element).find('form').ajaxSubmit({type:'POST',url:'/home/uploadphoto.json',data:{'json':JSON.stringify({ac:ac,rc:rc,ow:ow,can:can,cat:cat,tpp:tpp})},dataType:'json',success:function(data){$(targetPHotoPlaceHolder).removeClass('spinnerContainer');jQuery(me.element).find('form').resetForm();jQuery(me.element).find('img').prop('src',data.pl.uri);$('.imageWrapper').find('span.validationHolder.pleaseUploadImage').remove();me.objToMutate[me.toMutate]=data;jQuery(me.element).trigger('change');},error:function(err){targetPHotoPlaceHolder.removeClass('spinnerContainer');alert('上传失败了，请重试!');jQuery(me.element).find('img').attr('src',oldSrc);jQuery(me.element).find('form').resetForm();}});}
reader.readAsDataURL($(e.target)[0].files[0]);}}
PhotoUploadBoundValue.prototype.change=function change(e){if(e.target.getAttribute('data-bind')){this.emitChange();}}
InnerHtmlBinder.prototype=Object.create(BoundValue.prototype);InnerHtmlBinder.prototype.constructor=InnerHtmlBinder;InnerHtmlBinder.prototype.change=function(e){};InnerHtmlBinder.prototype.updateUI=function updateUI(){clearTimeout(this.initialBind);jQuery(this.element).text(this.objToMutate[this.toMutate]);};return BoundValue;}()),bind:function(container,object,nameSpace,changeListeners,formatters){var boundVals=[];jQuery(container).find('[data-bind]').each(function(){var item=this.getAttribute('data-bind').split('.');var itemPath=item.slice(1,item.length-1);var toMutate=item.slice(item.length-1)[0];var objToMutate=lbs.util.getMember(object,itemPath);var i=-1;var o=object;if(nameSpace&&(nameSpace!==item[0])){return 1;}if(objToMutate===undefined){if(!this.getAttribute('data-error-on-undefined-model')){throw new Error('Unable to get object to bind to.');}else{while((i+=1)<itemPath.length){if(o[itemPath[i]]===undefined){o[itemPath[i]]={};}o=o[itemPath[i]];}objToMutate=lbs.util.getMember(object,itemPath);}}boundVals.push(lbs.binder.BoundValue.create({element:this,toMutate:toMutate,objToMutate:objToMutate,changeListeners:changeListeners,formatters:formatters,root:object,path:item.slice(1)}));});return boundVals;},unbind:function(boundValues){var i=-1,len;len=boundValues.length||0;while(++i<len){boundValues[i].destroy();}},updateUI:function(boundValues){var i=-1,len=boundValues.length;while(++i<len){boundValues[i].updateUI();}},cancelUpdateObject:function cancelUpdateObject(boundValues){var i=-1,len=boundValues.length;while(++i<len){boundValues[i].cancelUpdateObject();}}};lbs.util={getMember:function getMember(o,memberNames){var i=-1,len=memberNames.length;while(++i<len){o=o[memberNames[i]];if(o===undefined||o===null){break;}}return o;},convertToString:function convertToString(arr){var i=-1,len=arr.length,ret=[];while(++i<len){ret.push(arr[i].toString());}return ret;},sortMethod:function(asc,key){var direction=asc?1:-1;return function(a,b){return(a[key]-b[key])*direction;};},merge:function(source,target){var key;for(key in source){if(Object.hasOwnProperty.call(source,key)){target[key]=source[key];}}},setSelect:function setSelect(el,val){if(val===undefined){return;}var $el=jQuery(el);$el.val(val);if($el.hasClass('selectpicker')){$el.selectpicker('render');}return;},emptyUi:function emptyUi(container){console.log('in empty ui----');$(container).find('input[type="text"], select').each(function(){console.log('this----',this);if(this.type==='text'){console.log('text type');$(this).val(' ');}if(this.tagName==='SELECT'){console.log('select type');$(this).find('option:eq(0)').prop('selected',true);if($(this).hasClass('selectpicker')){$(this).selectpicker('render');}}});},find:function(arg){var arr=arg.arr,key=arg.key,val=arg.val,index=arg.index||0,i=index-1,len=arr.length,multiple=arg.multiple,ret=multiple?[]:-1;while(++i<len){if(arr[i][key]===val){if(multiple){ret.push(i);}else{return i;}}}return ret;},findDeep:function(arg){var arr=arg.arr,key=arg.key.split('.'),val=arg.val,index=arg.index||0,i=index-1,len=arr.length,ret=-1;while(++i<len){if(lbs.util.getMember(arr[i],key)===val){return i;}}return ret;},shorter:function shorter(key,start,length){return function(){var item=lbs.util.getMember(this,key.split('.'));if(item){return item.substr(start,length);}return'';};},isArray:function isArray(obj){return Object.prototype.toString.call(obj).indexOf('Array')!==-1;},hideItem:function hideItem(target){if(!jQuery(target).is(':hidden')){jQuery(target).addClass('hide');}},showItem:function showItem(target){if(jQuery(target).is(':hidden')){jQuery(target).removeClass('hide');}},renderDate:function renderDate(){return function(text,render){return render(text).substr(0,10);};},renderDateTime:function renderDateTime(){return function(text,render){var cleantext=render(text).substr(0,10)+' '+render(text).substring(11,19);return cleantext;};},renderFileSizeInKB:function renderFileSizeInKB(){return function(text,render){var size=render(text);var cleantext='';if(size>0){cleantext=Math.round(size/1024)+' KB';}return cleantext;};},showFailureMessage:function showFailureMessage(arg){if(arg&&arg.message){lbs.modHelper.getView('/commons/views/faillure.html').then(function(view){lbs.modHelper.setContainer({container:'#platformAPIsModal',html:Mustache.render(view,{message:arg.message,title:arg.title?arg.title:null})});$('#platformAPIsModal').modal().off('hide.bs.modal.globalfailure');$('#platformAPIsModal').modal().on('hide.bs.modal.globalfailure',function(){lbs.modHelper.setContainer({container:'#platformAPIsModal',html:''});});})}else{console.log('error in show failure message');}},canRespond:function canRespond(arg){return $.when().then(function(){if(arg.activity.abd&&arg.activity.abd.ul){var itemNumber=parseInt(arg.activity.abd.ul),loggedIn=lbs.user!=undefined,userType=lbs.user?lbs.user.userType:undefined,validated=lbs.profile&&lbs.profile.vs=='已实名认证'?true:false;if(itemNumber===20&&(!loggedIn||!validated||userType!=='personal')){lbs.util.showFailureMessage({message:'只允许已认证个人用户响应',title:'事务响应性质提醒'});return false;}else if(itemNumber===30&&(!loggedIn||!validated||userType!=='corporate')){lbs.util.showFailureMessage({message:'只允许以认证单位用户响应',title:'事务响应性质提醒'});return false;}else if(itemNumber===40&&(!loggedIn||!validated)){lbs.util.showFailureMessage({message:'只允许已认证用户响应',title:'事务响应性质提醒'});return false;}}if(arg.activity.arc&&arg.activity.arc.mr>0&&arg.activity.arc.crc!==undefined){if(arg.activity.arc.mr<=arg.activity.arc.crc){lbs.util.showFailureMessage({message:'响应名额已满',title:'事务响应性质提醒'});return false;}}if(arg.activity.abd&&(arg.activity.abd.asd||arg.activity.abd.acd)){var now=new Date();if(arg.activity.abd.asd&&now<new Date(arg.activity.abd.asd)){lbs.util.showFailureMessage({message:'事务还未开始',title:'事务响应性质提醒'});return false;}else if(arg.activity.abd.acd&&now>new Date(arg.activity.abd.acd)){lbs.util.showFailureMessage({message:'事务响应已过期',title:'事务响应性质提醒'});return false;}}return true;});},showCountDownMessage:function showCountDownMessage(arg){jQuery.when().then(function(){if(arg&&arg.message){lbs.modHelper.getView('/workspace/firstTimeWelcomePopUp.html').then(function(view){lbs.modHelper.setContainer({container:'#platformAPIsModal',html:Mustache.render(view,{message:arg.message,count:arg.count||3})});$('#platformAPIsModal').modal().off('hide.bs.modal.globalCountDownd');$('#platformAPIsModal').modal().on('hide.bs.modal.globalCountDownd',function(){lbs.modHelper.setContainer({container:'#platformAPIsModal',html:''});});enxtendedCountDown(arg.count,'#platformAPIsModal',function(){$('#platformAPIsModal').modal('hide');});})}else{console.log('error in show countdownd message');}});},validationFileUrl:function validationFileUrl(){return function(text,render){var val=render(text);val=val.slice(0,val.indexOf('#'));return val;};},renderActivityTypes:function renderActivityTypes(e){return function(text,render){var arr=lbs.settings.messages.cn.activityTypes;var index=lbs.util.find({arr:arr,key:'val',val:render(text)});var value='';if(index>-1){value=arr[index].text;}return value}},renderServiceStatus:function renderServiceStatus(e){return function(text,render){var value=render(text).toString();var status='';if(value){status=lbs.settings.messages.serviceStatus[value].text;}return status;}},validationFileName:function validationFileName(){return function(text,render){var val=render(text);val=val.slice(val.indexOf('#')+1);return val;};},validateForm:function validateForm(element,status,typeofelement){var elem=element?$((element).parentNode):null;if(elem){if(status==='success'){elem.find('span.glyphicon-remove').remove();elem.find('span.mustfill').remove();if(element.tagName==='SELECT'){if(elem.find('select').hasClass('selectpicker')){lbs.util.overWriteSelectPickerHover(elem);elem.find('.bootstrap-select').append('<span class="validationHolder lan_absolute glyphicon  glyphicon-ok" style="color:#2785c3; right:10px; top:8px;"></span>');}else{elem.addClass('lan_relative');elem.append('<span class="validationHolder lan_absolute glyphicon  glyphicon-ok" style="color:#2785c3; right:25px; top:8px;"></span>');}}else if(element.type==='date'){lbs.util.hideValidatorOnDateInputHover(elem);elem.addClass('lan_relative');elem.append('<span class="validationHolder lan_absolute glyphicon  glyphicon-ok" style="color:#2785c3; right:25px; top:7px;"></span>');}else if(element.tagName==='DIV'||element.type==='checkbox'||element.type==='radio'){return;}else if(elem[0].tagName==='FORM'&&$(element).siblings('input[type="file"]')){return;}else{elem.addClass('lan_relative');elem.append('<span class="validationHolder lan_absolute glyphicon  glyphicon-ok" style="color:#2785c3; right:20px; top:8px;"></span>');}}else if(status==='fail'){elem.find('span.glyphicon-ok').remove();if(element.tagName==='SELECT'){if(elem.find('select').hasClass('selectpicker')){lbs.util.overWriteSelectPickerHover(elem);elem.find('.bootstrap-select').append('<span class="validationHolder lan_absolute glyphicon  glyphicon-remove" style="color:red; right:10px; top:8px;"></span>');}else{elem.addClass('lan_relative');elem.append('<span class="validationHolder lan_absolute glyphicon  glyphicon-remove" style="color:red; right:25px; top:8px;"></span>');}}else if(element.type==='date'){lbs.util.hideValidatorOnDateInputHover(elem);elem.addClass('lan_relative');elem.append('<span class="validationHolder lan_absolute glyphicon  glyphicon-remove" style="color:red; right:30px; top:10px;"></span>');}else if(element.type==='textarea'){elem.addClass('lan_relative');elem.append('<span class="validationHolder lan_absolute glyphicon  glyphicon-remove" style="color:red; right:20px; top:8px;"></span>');}else if(typeofelement==='image'){$('.imageWrapper').addClass('lan_relative');$('.imageWrapper').append('<span class="validationHolder lan_absolute pleaseUploadImage" style="color:red; right:30px; bottom:50px;">请上传照片!</span>');}else if(element.tagName==='DIV'||element.type==='checkbox'||element.type==='radio'){return;}else if(elem[0].tagName==='FORM'&&$(element).siblings('input[type="file"]')){return;}else{elem.addClass('lan_relative');elem.append('<span class="validationHolder lan_absolute glyphicon  glyphicon-remove" style="color:red; right:20px; top:8px;"></span>');}}}},validateRequiredFormFieds:function validateRequiredFormFieds(container,element){var valid=true;var doemElem=$(element);if(element){return jQuery.when().then(function(){var atribute=element.getAttribute('data-verification');var valueBoundTo=element.getAttribute('data-bind');if(atribute==='true'){if(element.type==='text'||element.type==='textarea'||element.tagName==='SELECT'){var requiredVal=$(element).val();console.log('requiredVal--',requiredVal);if(!requiredVal){valid=false;lbs.util.validateForm(element,'fail');}else if(valueBoundTo==='entity.fields.LZSID'){var idValReuslt=IdentityCodeValid(requiredVal);if(!idValReuslt.valid){valid=false;lbs.util.validateForm(element,'fail');}}}else if(element.tagName==='DIV'&&$(element).hasClass('imageWrapper')){console.log('checking image-----');var patern=/\/commons\/images\/IDPhotoSubmitedDemo.png/;if(!patern.test($(element).find('img').prop('src'))){valid=false;lbs.util.validateForm(element,'fail','image');}}}else{console.log('not required');}}).then(function(){if(valid){$('#formRequiredFieldsFeedBack').addClass('hide');}return valid;});}else{return jQuery.when().then(function(){$(container).find("[data-verification=true]").each(function(){var valueBoundTo=this.getAttribute('data-bind');if(this.type==='text'||this.type==='textarea'||this.tagName==='SELECT'){var requiredVal=$(this).val();if(!requiredVal){valid=false;lbs.util.validateForm(this,'fail');}else if(valueBoundTo==='entity.fields.LZSID'){var idValReuslt=IdentityCodeValid(requiredVal);if(!idValReuslt.valid){valid=false;lbs.util.validateForm(element,'fail');}}}else if(this.tagName==='DIV'&&$(this).hasClass('imageWrapper')){console.log('checking image-----');var patern=/\/commons\/images\/IDPhotoSubmitedDemo.png/;if(!patern.test($(this).find('img').prop('src'))){valid=false;lbs.util.validateForm(this,'fail','image');}}});}).then(function(){if(!valid){$('#formRequiredFieldsFeedBack').removeClass('hide');}return valid;});}},overWriteSelectPickerHover:function overWriteSelectPicketHover(elem){elem.find('.bootstrap-select').addClass('lan_relative lanValidating');elem.find('.bootstrap-select').find('.caret').addClass('hide');elem.find('.bootstrap-select').mouseenter(function(){elem.find('.bootstrap-select').find('.caret').removeClass('hide');});elem.find('.bootstrap-select').mouseleave(function(){if(elem.find('.bootstrap-select').hasClass('lanValidating')){elem.find('.bootstrap-select').find('.caret').addClass('hide');}});},hideValidatorOnDateInputHover:function hideValidatorOnDateInputHover(elem){elem.mouseenter(function(){elem.find('.validationHolder').addClass('hide');});elem.mouseleave(function(){elem.find('.validationHolder').removeClass('hide');});},checkMobileMatch:function checkMobileMatch(elem1,elem2,notifierContainer){var value1=jQuery(elem1).val();var value2=jQuery(elem2).val();console.log('validateMobile(value1)----',validateMobile(value1));if(value1!==value2){jQuery(notifierContainer).css({"background":"url(../../commons/images/wrong_state.png)  left center no-repeat","padding-left":"18px","font-size":"80%"}).html("输入内容不一致!");return false;}else if(!validateMobile(value1)){jQuery(notifierContainer).css({"background":"url(../../commons/images/wrong_state.png)  left center no-repeat","padding-left":"18px","font-size":"80%"}).html("手机号不合格!");return false;}else{jQuery(notifierContainer).css({"background":"url(../../commons/images/right_state.png)  left center no-repeat","padding-left":"18px"}).html(" ");return true;}},preventOpenningEmptyLinks:function preventOpenningEmptyLinks(container){$(container).find('a').each(function(){$(this).click(function(e){var url=$(this).prop('href');if(url){var urlending=url.split('/').pop();if(!urlending){e.preventDefault();}}});});}};lbs.modHelper.returnResolved=function returnResolved(ret){var d=jQuery.Deferred();setTimeout(function(){d.resolve(ret);});return d.promise();};(function(loadedMods){lbs.modHelper.setContainer=function setContainer(arg){var currentMod=loadedMods[arg.container];if(currentMod&&arg.mod!==currentMod&&(typeof currentMod.remove==='function')){currentMod.remove();}jQuery(arg.container).html(arg.html);loadedMods[arg.container]=arg.mod;};}({}));lbs.modHelper.getView=function(location,cache){cache=(cache===false)?false:true;var fetcher=new lbs.modHelper();return fetcher.fetch({url:location,cache:cache,type:'view'});};lbs.modHelper.getUser=function(arg){arg=arg||{};var recoverOptions=arg.recoverOptions||{};recoverOptions.message=recoverOptions.message||'You have to log in to continue';recoverOptions.persist=(recoverOptions.persist===false)?false:true;var d=jQuery.Deferred();lbs.modHelper.getMod('/workspace').then(function(mod){if(typeof mod.create==='function'){mod.create();}return mod.handleLogin(recoverOptions);}).then(function(message){d.resolve();});return d.promise();};lbs.modHelper.recover=function recover(arg){if(arg&&arg.custom){lbs.util.showFailureMessage({message:arg.custom});}else if(arg&&arg.msg&&arg.msg.responseJSON&&arg.msg.responseJSON.er){if(arg.msg.responseJSON.er.ec===8401||arg.msg.responseJSON.er.ec===8404){return lbs.modHelper.getUser(arg);}}else if(arg&&arg.msg&&arg.msg.readyState===0){console.log('do something for not connected',arg);lbs.util.showFailureMessage({message:'Not connected, please check your connection!'});}else if(arg&&arg.msg&&arg.msg.status===500){lbs.util.showFailureMessage({message:'Server error: please try again later!'});}else if(arg&&arg.msg&&arg.msg.status===404){lbs.util.showFailureMessage({message:'resource not found, please try again!'});}else{console.log('Unkown failure:',arg);lbs.util.showFailureMessage({message:'Unknown failure, please try again later!'});}var d=jQuery.Deferred();setTimeout(function(){console.log('rejecting');d.reject('Unable to recover or recover not implemented.');});return d.promise();};lbs.modHelper.getMessage=function(location,cache,recoverOptions,httpType,data){var fetcher=new lbs.modHelper();var d=jQuery.Deferred();fetcher.fetch({url:location,cache:(cache===true)?true:false,type:'endpoint',httpType:httpType||'GET',data:data||{}}).then(function success(msg){d.resolve(msg);},function reject(msg){var obj={msg:msg,location:location,recoverOptions:recoverOptions,custom:null}
if(!recoverOptions){d.reject(msg);return;}else if(recoverOptions.custom){obj.custom=recoverOptions.custom}lbs.modHelper.recover(obj).then(function(){lbs.modHelper.getMessage(location,cache,false,httpType,data).then(function resolve(msg){d.resolve(msg);},function reject(reason){d.reject(reason);});},function reject(reason){d.reject(reason);});});return d.promise();};lbs.modHelper.getScriptFromUrl=function(arg){var defer=jQuery.Deferred();var script;var version=/.*\/main\.js$/.test(arg.url)?lbs.settings.version:'';script=document.createElement('script');script.onload=function(e){defer.resolve(arg);};script.onerror=function(e){defer.reject('cannot load this.');};script.src=arg.url+version;document.head.appendChild(script);return defer.promise();};lbs.modHelper.getCssFromUrl=function(arg){var defer=jQuery.Deferred();var css;css=document.createElement('link');css.onload=function(e){defer.resolve(arg);};css.onerror=function(e){defer.reject('cannot load this.');};css.rel='stylesheet';css.href=arg.url;document.head.appendChild(css);return defer.promise();};lbs.modHelper.getMod=function(route){var f=new lbs.modHelper();var mod;var deps;var i=-1,len;var d=jQuery.Deferred();var promises=[];f.fetch({url:route}).then(function(route){mod=lbs.modules[route.routeurl];if(mod&&(typeof mod==='function')){mod=new mod();}if(!(mod&&mod.deps)){d.resolve(mod);return;}deps=mod.deps;len=(deps&&deps.length)?deps.length:0;while(++i<len){promises.push(lbs.modHelper.getMod(deps[i]));}jQuery.when.apply(jQuery,promises).then(function(){if(mod&&(typeof mod.create==='function')){mod.create();}if(mod&&(typeof mod==='function')){mod=new mod();}d.resolve(mod);});});return d.promise();};lbs.modHelper.prototype.fetch=function(arg){this.defer=jQuery.Deferred();var me=this;var cacheVal=true;this.start=new Date().getTime();this.type=arg.type||'mod';this.url=this.location=arg.url;this.cache=(arg.cache===false)?false:this.cache;this.container=arg.container||false;this.response=null;if(this.type==='mod'){return this.getScript();}if(/.html$/.test(this.url)){this.url=this.url+lbs.settings.version;this.location=this.url;}if((this.cache===false)){cacheVal=false;}jQuery.ajax({url:this.url,cache:cacheVal,data:arg.data||{},type:arg.httpType||'GET'}).then(function(res){me.response=res;me.gotResponse();}).fail(function(reason){me.defer.reject(reason);});return this.defer.promise();};lbs.modHelper.prototype.getScript=function getScript(){this.route=lbs.routes[this.url];if(!this.route){throw new Error('Unknown route:'+this.url);}var mod=lbs.modules[this.url];this.location=this.route.location;var me=this;if(!mod){lbs.modHelper.getScriptFromUrl({url:this.location}).then(function(){me.route.routeurl=me.url;me.defer.resolve(me.route);});}else{this.route.routeurl=this.url;this.defer.resolve(this.route);}return this.defer.promise();};lbs.modHelper.prototype.gotResponse=function gotResponse(){this.defer.resolve(this.response);};lbs.modHelper.createIsSelected=function createIsSelected(val,key){if(Object.prototype.toString.call(val)==="[object Array]"){val=lbs.util.convertToString(val);return function(){var listVal=(key)?lbs.util.getMember(this,key.split('.')):this;listVal=((listVal||listVal===0||listVal===false)&&typeof listVal.toString==='function')?listVal.toString():listVal;return val.indexOf(listVal)!==-1?'selected':'';};}return function(){var listVal=(key)?lbs.util.getMember(this,key.split('.')):this;listVal=((listVal||listVal===0||listVal===false)&&typeof listVal.toString==='function')?listVal.toString():listVal;val=((val||val===0||val===false)&&typeof val.toString==='function')?val.toString():val;return listVal===val?'selected':'';};};lbs.modHelper.isChecked=function isChecked(entityList,key){return function(){return entityList.indexOf(this[key].toString())>-1?'checked':'';};};lbs.modHelper.isVal=function isVal(arg){return function(){arg.obj=arg.obj||this;var key=(typeof arg.key==='function')?arg.key():arg.key,val=(typeof arg.val==='function')?arg.val():arg.val;if(arg.obj[key]===val){return arg.yes;}return arg.no;};};lbs.modHelper.index=function index(arg){arg=arg||{};var indx=arg.index||0;return function(){return indx++;};};lbs.modHelper.getView('/commons/views/modal.html');lbs.validator=(function(){var BaseValidator=function(){};var ServiceValidator=function(arg){BaseValidator.call(this,arg);};var types={'service':ServiceValidator};BaseValidator.create=function(type){if(typeof types[type]==='function'){return new types[type]();}};BaseValidator.bindCss=function bindCss(arg){var $elems=jQuery(arg.container).find('[data-validate]').each(function(){});};BaseValidator.prototype.rangeString=function rangeString(val,min,max){var evals=[],i=-1,len,ret=true;val=val||'';if(min!==undefined){evals.push(val.replace(/\s/igm,'').length>=min);}if(max!==undefined){evals.push(val.replace(/\s/igm,'').length<=max);}len=evals.length;while(++i<len){ret=ret&&evals[i];}return ret;};BaseValidator.prototype.rangeNumber=function(val,min,max){var evals=[],i=-1,len,ret=true,numVal;numVal=parseFloat(val,10);evals.push(!isNaN(numVal));if(min!==undefined){evals.push(numVal>=min);}if(max!==undefined){evals.push(numVal<=max);}len=evals.length;while(++i<len){ret=ret&&evals[i];}return ret;};ServiceValidator.prototype=Object.create(BaseValidator.prototype);ServiceValidator.prototype.constructor=ServiceValidator;ServiceValidator.prototype.serviceName=function(arg){arg=arg||{};if(arg.val&&arg.val._id){return true;}var name=(arg.val&&(typeof arg.val.text!=='undefined'))?arg.val.text:arg.val;if(!this.rangeString(name,1)){return lbs.settings.messages.validate.service.NAME_EMPTY;}return true;};ServiceValidator.prototype.standardServicePrice=function(arg){if(this.rangeString(new String(arg.val),0,0)){return true;}if(!this.rangeNumber(arg.val)){return lbs.settings.messages.validate.service.STANDARD_PRICE_NOT_NUMBER;}return true;};ServiceValidator.prototype.standardPricing=function(arg){if(this.standardServicePrice(arg)!==true){return lbs.settings.messages.validate.service.DISCOUNT_PRICE_NOT_NUMBER;}return true;};ServiceValidator.prototype.fields={serviceName:ServiceValidator.prototype.serviceName,standardServicePrice:ServiceValidator.prototype.standardServicePrice,standardPricing:ServiceValidator.prototype.standardPricing};ServiceValidator.prototype.validate=function validate(arg){arg=arg||{};var key,hasOwn=Object.prototype.hasOwnProperty,validates=[],i=-1,len,ret=[];var fields=arg.fields||this.fields;for(key in fields){if(hasOwn.call(fields,key)){validates.push(this[key]({val:arg.val[key]}));}}len=validates.length;while(++i<len){if(validates[i]!==true){ret.push(validates[i]);}}return(ret.length===0)?true:ret;};var CssValidator=function CssValidator(arg){var path=this.Attribute('data-validate').split('.');this.entityName=path[0];this.valProp=path[0];this.entity=arg.entity;this.validator=BaseValidator.create();this.element=arg.element;var me=this;jQuery(this.element).on('change',function(e){me.change(e);});};CssValidator.prototype.change=function change(e){};return BaseValidator;}());function v_aligner(){var leftContainPositionLeft,leftContainPositionTop,rightContainPositionLeft,halfSeparationLine,rightContainPositionTop,otherLoginMethodsLeft,searchPositionRight,width,regBoxTop,regBoxLeft=0;width=jQuery(window).width();if(width>390){if(width<570){rightContainPositionLeft=(jQuery('#home_right_container').width()-jQuery('#home_login_form').width())/2;otherLoginMethodsLeft=(jQuery('#home_right_container').width()-jQuery('#otherLoginMethods').width())/2+17;rightContainPositionTop=(jQuery('#home_right_container').height()-jQuery('#home_login_form').height())/2-20;}else{halfSeparationLine=jQuery('#home_separation_line')/2;rightContainPositionLeft=(jQuery('#home_right_container').width()-jQuery('#home_login_form').width())/2-15;rightContainPositionTop=(jQuery('#home_right_container').height()-jQuery('#home_login_form').height())/2-20;otherLoginMethodsLeft=(jQuery('#home_right_container').width()-jQuery('#otherLoginMethods').width())/2-15;searchPositionRight=(jQuery('#home_right_container').width()-jQuery('#home_login_form').width())/2-15;jQuery('#home_search').css({"position":"absolute","top":0,"left":searchPositionRight});}leftContainPositionLeft=(jQuery('#home_left_container').width()-jQuery('#home_left_contain').width())/2;leftContainPositionTop=(jQuery('#home_left_container').height()-jQuery('#home_left_contain').height())/2;regBoxTop=(jQuery('.notHomeMainContainer').height()-jQuery('#regBox').height())/2;regBoxLeft=(jQuery('.notHomeMainContainer').width()-jQuery('#regBox').width())/2;jQuery('#home_left_contain').css({"position":"absolute","top":leftContainPositionTop,"left":leftContainPositionLeft});jQuery('#home_login_form').css({"position":"absolute","top":rightContainPositionTop,"left":rightContainPositionLeft});jQuery('#otherLoginMethods').css({"position":"absolute","bottom":"15px","left":otherLoginMethodsLeft});jQuery('#regBox').css({"position":"absolute","top":regBoxTop,"left":regBoxLeft});}}jQuery(window).resize(function(){});var updateWorkSpaceRightContainerOnClick=function(element_attr,script_source_url){jQuery(element_attr).click(function(e){if(script_source_url==="/home/master"){jQuery.bbq.pushState('#');}else if(script_source_url==="/workspace/welcome"){jQuery.bbq.pushState('#'+'/workspace/welcome');}else{jQuery.bbq.pushState('#'+script_source_url);}e.preventDefault();});};var masterPageStatus=false;jQuery(function(){jQuery(window).bind("hashchange",function(e){var url=jQuery.param.fragment();var regexpRouters=[{mod:'lbs.workspace.smm.detail',location:'/workspace/services/main.js',uid:'/workspace/services/detail',regExp:/^\/workspace\/services\/(myservicepoints|myservices)\/(LZS|LZP).*$/},{mod:'lbs.workspace.inspection:folder',location:'/workspace/inspection/main.js',uid:'/workspace/inspection:folder',regExp:/^\/workspace\/inspection\/.*\/folder\/.*$/},{mod:'lbs.workspace.corrections:folder',location:'/workspace/corrections/main.js',uid:'/workspace/corrections:folder',regExp:/^\/workspace\/corrections\/.*\/folder\/.*$/},{mod:'lbs.home:search',location:'/home/detailPages/main.js',uid:'/home/detailPages/search',regExp:/^\/home\/detailPages\/search\/.*$/},{mod:'lbs.workspace:nomenu.publishing.activities',location:'/workspace/publishing/main.js',uid:'/workspace/publishing/activities',regExp:/\/workspace\/publishing\/activities.*$/},{mod:'lbs.workspace:nomenu.publishing.activities',location:'/details/activities/main.js',uid:'/details/edit/activitydetail',regExp:/\/details\/activitydetail.*$/i},{mod:'lbs.workspace:nomenu.publishing.activities',location:'/details/activities/main.js',uid:'/details/edit/activitydetail',regExp:/\/details\/.*\/activitydetail.*$/i},{mod:'lbs.workspace:nomenu.publishing.activities',location:'/details/corporate/main.js',uid:'/details/corporate/corporatedetail',regExp:/\/details\/.*\/corporatedetail.*$/i},{mod:'lbs.workspace:nomenu.publishing.activities',location:'/details/servicepoint/main.js',uid:'/details/servicepointdetail',regExp:/\/details\/.*\/servicepoint\/(\S+).*$/i},{mod:'lbs.workspace:nomenu.publishing.activities',location:'/processes/photoservice/main.js',uid:'/processes/photoservice/photoServices',regExp:/\/processes\/photoservice.*$/i},{mod:'lbs.workspace:nomenu.publishing.activities',location:'/processes/photoservice/main.js',uid:'/processes/photoservice/photoShooting',regExp:/\/processes\/photoservice\/photoShooting/i},{mod:'lbs.workspace:nomenu.publishing.activities',location:'/processes/photoservice/main.js',uid:'/processes/photoservice/photoPrinting',regExp:/\/processes\/photoservice\/photoPrinting/i},{mod:'lbs.workspace:nomenu.publishing.activities',location:'/processes/photoservice/main.js',uid:'/processes/photoservice/payment',regExp:/\/processes\/photoservice\/payment/i},{mod:'lbs.workspace:nomenu.publishing.activities',location:'/processes/photoservice/main.js',uid:'/processes/photoservice/done',regExp:/\/processes\/photoservice\/done/i},{mod:'lbs.workspace:nomenu.publishing.activities',location:'/processes/verifications/main.js',uid:'/processes/verifications/verificationServices',regExp:/\/processes\/verifications\/verificationServices/i},{mod:'lbs.workspace:nomenu.publishing.activities',location:'/processes/verifications/main.js',uid:'/processes/verifications/groupIDForm',regExp:/\/processes\/verifications\/groupIDForm/i},{mod:'lbs.workspace:nomenu.publishing.activities',location:'/processes/verifications/main.js',uid:'/processes/verifications/singleIDForm',regExp:/\/processes\/verifications\/singleIDForm/i},{mod:'lbs.workspace:nomenu.publishing.activities',location:'/processes/verifications/main.js',uid:'/processes/verifications/checkIDForm',regExp:/\/processes\/verifications\/checkIDForm/i},{mod:'lbs.workspace:nomenu.publishing.activities',location:'/processes/verifications/main.js',uid:'/processes/verifications/payment',regExp:/\/processes\/verifications\/(\S+).*\/payment/i},{mod:'lbs.workspace:nomenu.publishing.activities',location:'/processes/verifications/main.js',uid:'/processes/verifications/done',regExp:/\/processes\/verifications\/(\S+).*\/done/i},{mod:'lbs.workspace:nomenu.publishing.activities',location:'/processes/activities/main.js',uid:'/processes/activities/activities',regExp:/\/processes\/activities\/activities/i},{mod:'lbs.workspace:nomenu.publishing.activities',location:'/processes/activities/main.js',uid:'/processes/activities/application',regExp:/\/processes\/activities\/application/i},{mod:'lbs.workspace:nomenu.publishing.activities',location:'/processes/activities/main.js',uid:'/processes/activities/done',regExp:/\/processes\/activities\/done/i},{mod:'lbs.workspace:nomenu.publishing.activities',location:'/processes/activities/main.js',uid:'/processes/activities/payment',regExp:/\/processes\/activities\/payment/i},{mod:'lbs.workspace.profile',location:'/workspace/profile/main.js',uid:'/workspace/profile/personalprofile',regExp:/\/workspace\/profile\/personalprofile\/?/i}];function isRegexRouted(url){var i=regexpRouters.length;while(--i>-1){if(regexpRouters[i].regExp.test(url)){return regexpRouters[i];}}return false;}var routeMod=function(url){var start=new Date().getTime();return lbs.modHelper.getMod(url).then(function(mod){mod=lbs.util.getMember(window,lbs.routes[url].mod.split('.'));if(mod&&(mod.container)){lbs.loadingMods[mod.container]=lbs.loadingMods[mod.container]||[];lbs.loadingMods[mod.container].push({start:start});lbs.loadingMods[mod.container].sort(lbs.util.sortMethod(false,'start'));if(lbs.loadingMods[mod.container][0].start===start){mod.render().then(function(){lbs.basemodule.pageComplete();});}}});};var oldMethod=function(){if(urlsplit.length>3){jQuery.getScript(url+'.js');}else if(url===''){jQuery.getScript('/home/master.js');}else if(url==='/workspace/welcome'){jQuery.getScript('/workspace/welcome/master.js');}else if(url==='/home/userRegistration'){jQuery.getScript('/home/userRegistration.js');}else if(urlsplit[1]==='publishing'){}};var route,mod;url=(url==='')?'/home':url;var urlsplit=url.split('/');if(lbs.routes[url]){routeMod(url);return;}else if(isRegexRouted(url)){route=isRegexRouted(url);mod=lbs.modules[route.uid]||lbs.modHelper.getScriptFromUrl({url:route.location,location:route.uid});jQuery.when(mod).then(function resolve(msg){routeMod(route.uid);},function reject(){oldMethod();});return;}else{lbs.modHelper.getScriptFromUrl({url:urlsplit.slice(0,urlsplit.length-1).join('/')+'/main.js',location:url}).then(function resolve(msg){routeMod(msg.location);},function reject(){console.log('using old method for url:',url);oldMethod();});return;}});jQuery(window).trigger("hashchange");});function slideEffectsHandler(arg){detailPageSlideHandler(arg);leftNavMenuItemSlideHandler();}function detailPageSlideHandler(arg){jQuery(".detailPageUserIntroBoxHeader .detailPageDropDownIcon").click(function(e){e.preventDefault();var $target=jQuery(this).closest('.detailPageUserIntroBoxHeader').next();if($target.is(":hidden")){jQuery(this).removeClass('glyphicon-menu-down');jQuery(this).addClass('glyphicon-menu-up');$target.slideDown("fast");}else{jQuery(this).addClass('glyphicon-menu-down');jQuery(this).removeClass('glyphicon-menu-up');$target.slideUp('fast');}});jQuery('.editDetailPageBtn').click(function(e){var $targetbtn=jQuery(this).prev().find('.detailPageUserIntroBoxHeader .detailPageDropDownIcon');var $targetContainer=jQuery(this).prev().find('.detailPageUserIntroBoxBody');if($targetContainer.is(':hidden')){$targetbtn.removeClass('glyphicon-menu-down');$targetbtn.addClass('glyphicon-menu-up');$targetContainer.slideDown("fast");}});}function leftNavMenuItemSlideHandler(){console.log('old slide handler');return;}var highLightSelectedSubmunuItem=function(e){console.log('old highlight, do nothing');return;};function table_effects(){paddingEffecfts();jQuery('.table .row:first-child .cell:nth-child(3)').addClass('swapBg');jQuery('.Swap').click(function(){if(jQuery(this).hasClass('swapBg')||jQuery(this).hasClass('swapBg2')){jQuery(this).toggleClass('swapBg swapBg2');}else{jQuery(this).addClass('swapBg');jQuery(this).siblings().removeClass('swapBg');jQuery(this).siblings().removeClass('swapBg2');}});jQuery('.lan_table_more').off('tap');jQuery('.lan_table_more').on('tap',function(e){e.preventDefault();jQuery(this).find('ul').css('display','block');jQuery(document).on('tap',function(e){var container=jQuery(".lan_table_more");if(!container.is(e.target)&&container.has(e.target).length===0){container.find('ul').css('display','none');}});});}function paddingEffecfts(){jQuery("#pagging button:nth-child(2)>a").addClass('activeClick');jQuery("#pagging button a").hover(function(e){jQuery(this).addClass('activeHover');e.preventDefault();},function(e){jQuery(this).removeClass('activeHover');e.preventDefault();});jQuery("#pagging button a").click(function(e){jQuery(this).addClass('activeClick');jQuery(this).parent().siblings().find('a').removeClass('activeClick');e.preventDefault();});}function sidebar(){var right_container_width,right_container_width_for_mini=0;var width=jQuery(window).width();jQuery(".clickMe").click(function(){if(width>768){right_container_width=(jQuery(".wrapper").width()-jQuery("#left_nav").width())+25;jQuery(".leftNavigations #left_nav_mini").css("display","none");jQuery(".leftNavigations #left_nav").css("display","block");jQuery(".leftNavigations #left_nav").find('.nav_list_bg').css("display","block");jQuery('#right_container').css({"width":right_container_width,"":""});}jQuery('#right_container').addClass('menu-expand');});jQuery(".clickMeHide").click(function(){right_container_width_for_mini=(jQuery(".wrapper").width()-jQuery("#left_nav_mini").width())+25;jQuery(".leftNavigations #left_nav_mini").css("display","block");jQuery(".leftNavigations #left_nav").css("display","none");jQuery('.leftNavigations .nav_list_bg').css({"display":"none","":""});jQuery('#right_container').css({"width":right_container_width_for_mini,"":""});showSideFrame();jQuery('#right_container').removeClass('menu-expand');});sidebarSwaper();jQuery(window).resize(function(){sidebarSwaper();});jQuery("#Profile_arrow_up").click(function(){jQuery("#profile").css("display","none");jQuery(this).css("display","none");jQuery("#Profile_arrow_down").css("display","block");});jQuery("#Profile_arrow_down").click(function(){jQuery("#profile").css("display","block");jQuery(this).css("display","none");jQuery("#Profile_arrow_up").css("display","block");});}function showSideFrame(){jQuery(".service_icon").hover(function(){jQuery(this).find(".leftNavigations .nav_list_bg").css("display","block");jQuery(this).find(".leftNavigations .nav_list_bg").find('.detail_frame').css("display","block");jQuery(this).siblings().find(".leftNavigations .nav_list_bg").css("display","none");},function(){jQuery(this).find(".leftNavigations .nav_list_bg").css("display","none");});}function sidebarSwaper(){var width=jQuery(window).width();showSideFrame();if(width>=991){jQuery(".leftNavigations #left_nav").css("display","block");jQuery(".leftNavigations #left_nav_mini").css("display","none");}if(width<991){if(jQuery(".leftNavigations #left_nav_mini").is(':hidden')){jQuery(".leftNavigations #left_nav_mini").css("display","block");jQuery('.leftNavigations .nav_list_bg').css({"display":"none","":""});jQuery(".leftNavigations #left_nav").css("display","none");jQuery('.leftNavigations .nav_list_bg').hover(function(e){jQuery(this).css({"display":"block","position":"absolute","left":jQuery("#left_nav_mini").width(),"top":"0"});});}if(width<760){jQuery('#right_container').width(jQuery(".wrapper").width()-jQuery("#left_nav_mini").width()+25);}else if(width<560){jQuery('#right_container').width(jQuery(".wrapper").width()-jQuery("#left_nav_mini").width()+20);}else{jQuery('#right_container').width(jQuery(".wrapper").width()-jQuery("#left_nav_mini").width()+20);}}else{if(jQuery("#left_nav").is(':hidden')){jQuery("#left_nav").css("display","block");jQuery('.nav_list_bg').css({"display":"block","":""});jQuery("#left_nav_mini").css("display","none");}jQuery('#right_container').width(jQuery(".wrapper").width()-jQuery("#left_nav").width()+25);}}var ShiftOperationIndicatorBar=function(element){jQuery(element).addClass("forgotPwProcedureIndicator");jQuery(element).siblings().removeClass("forgotPwProcedureIndicator");};var idphotoGalerySlider=function(){jQuery('.right').addClass('idphotoGaleryClickRight');jQuery('#idphotoGaleryContainNext').addClass('displayNone');jQuery('.idPhotoGalery .left').click(function(e){if(jQuery('#idphotoGaleryContain').is(':hidden')){jQuery('#idphotoGaleryContainNext').css('display','none');jQuery('#idphotoGaleryContain').css('display','block');jQuery('.right').addClass('idphotoGaleryClickRight');jQuery('.left').removeClass('idphotoGaleryClickLeft');}});jQuery('.idPhotoGalery .right').click(function(e){if(jQuery('#idphotoGaleryContainNext').is(':hidden')){jQuery('#idphotoGaleryContainNext').css('display','block');jQuery('#idphotoGaleryContain').css('display','none');jQuery('.left').addClass('idphotoGaleryClickLeft');jQuery('.right').removeClass('idphotoGaleryClickRight');}});};var countDown=function(callback){var cnt;clearInterval(cnt);var doCountUpdate=function(){jQuery('em.countDown').each(function(){var count=parseInt(jQuery(this).html(),10);if(count!==1){jQuery(this).html(count-1);}else{if(callback&&(typeof callback==='function')){callback();clearInterval(cnt);}}});};cnt=setInterval(doCountUpdate,1000);};var enxtendedCountDown=function(start,container,callback){var counter;var count=start||3;clearInterval(counter);var target=container||'';var enxtendedDoCountUpdate=function(){var countElem=jQuery(target+' em.countDown');if(count!==0){countElem.html(count);count=count-1;}else{if(callback&&(typeof callback==='function')){callback();clearInterval(counter);}}};counter=setInterval(enxtendedDoCountUpdate,1000);};var passWordStrengh=function passWordStrengh(){console.log('checking pw strengh-----');jQuery("ul.strength").css("display","none");jQuery("#password, #modalRegUserPassWord").keyup(function(){var i;jQuery("ul.strength").css("display","block");var input=jQuery(this).val();var res=strongCheck(input);if(res<=0){jQuery('#pwStrengthComment').html("密码太短了!");jQuery("ul.strength li").css("background-color","#ddd");}else if(res==1){jQuery('#pwStrengthComment').html("弱!");jQuery("ul.strength li").css("background-color","#ddd");jQuery("ul.strength li").css("background-color","#F22");}else if(res==2){jQuery('#pwStrengthComment').html("中!");jQuery("ul.strength li").css("background-color","#ddd");for(i=1;i<=res;i++){jQuery("ul.strength li."+i).css("background-color","#FF6922");}}else if(res==3){jQuery('#pwStrengthComment').html("强!");jQuery("ul.strength li").css("background-color","#ddd");for(i=1;i<=res;i++){jQuery("ul.strength li."+i).css("background-color","#FFE422");}}else if(res==4){jQuery("ul.strength li").css("background-color","#ddd");jQuery('#pwStrengthComment').html("强!");for(i=1;i<=res;i++){jQuery("ul.strength li."+i).css("background-color","#A7E623");}}});}
var clearErrorMessage=function clearErrorMessage(e){$("#lanzhengCodeForResponse").keydown(function(){$('#errorMessageHolder').text('')});}
function strongCheck(password){var strength=0;if(password.length<6){return 0;}else{strength+=1;if(password.match(/([a-z].*[A-Z])|([A-Z].*[a-z])/)){strength+=1;}if(password.match(/([a-zA-Z])/)&&password.match(/([0-9])/)){strength+=1;}if(password.match(/([!,%,&,@,#,$,^,*,?,_,~])/)){strength+=1};if(password.match(/(.*[!,%,&,@,#,$,\^,*,?,_,~].*[!,%,&,@,#,$,\^,*,?,_,~])/)){strength+=1;}return strength;}}var checkPasswordMatch=function checkPasswordMatch(){console.log('password match');var password=jQuery("#password").val();var confirmPassword=jQuery("#conformPassword").val();if(password!==confirmPassword){jQuery("#conformPassword").next().css({"background":"url(../../commons/images/wrong_state.png)  left center no-repeat","padding-left":"18px"}).html(" 密码不一致!");}else{jQuery("#conformPassword").next().css("background","url(../../commons/images/right_state.png)  left center no-repeat").html(" ");}var modalpassword=jQuery("#modalRegUserPassWord").val();var modalconfirmPassword=jQuery("#modalRegUserConfirmPassWord").val();if(modalpassword!==modalconfirmPassword){jQuery("#pwMatchingComment").css({"background":"url(../../commons/images/wrong_state.png)  left   center no-repeat","padding-left":"18px"}).html(" 密码不一致!");}else{jQuery("#pwMatchingComment").before().css("background","url(../../commons/images/right_state.png)  left  center no-repeat").html("密码一致 ");}};function checkEmptyPassword(){var password=jQuery("#password").val();if(password!==confirmPassword){jQuery("#conformPassword").next().html(" 密码不一致!");}else{jQuery("#conformPassword").next().html(" match!");}}function makeRandomString(){var i;var chars="ABCDEFGHIJKLMNPQRSTUVWXTZ";var randomstring='';for(i=0;i<4;i++){var rnum=Math.floor(Math.random()*chars.length);randomstring+=chars.substring(rnum,rnum+1);}return randomstring;}function randomString(){randomstring=makeRandomString();jQuery("#antiBotValue").val(randomstring);jQuery('.home_check').html(randomstring);}$.fn.serializeObject=function(){var o={};var a=this.serializeArray();$.each(a,function(){if(o[this.name]){if(!o[this.name].push){o[this.name]=[o[this.name]];}o[this.name].push(this.value||'');}else{o[this.name]=this.value||'';}});return o;};function getParameterByName(name,url){name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var regex=new RegExp("[\\?&]"+name+"=([^&#]*)"),results=regex.exec(url);return results===null?"":decodeURIComponent(results[1].replace(/\+/g," "));}randomString();window.onload=randomString;var preventDisabledClick=function(){$('.blueButton, .grayButton').each(function(){if($(this).find('span.disabled')){$(this).off().on('click',function(){console.log('disabled button clicked');return;});}});}
function IdentityCodeValid(code){var city={11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙古",21:"辽宁",22:"吉林",23:"黑龙江 ",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",41:"河南",42:"湖北 ",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",52:"贵州",53:"云南",54:"西藏 ",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",71:"台湾",81:"香港",82:"澳门",91:"国外 "};var tip="";var pass=true;if(!code||!/^\d{6}(18|19|20)?\d{2}(0[1-9]|1[12])(0[1-9]|[12]\d|3[01])\d{3}(\d|X)$/i.test(code)){tip="身份证号格式错误";pass=false;}else if(!city[code.substr(0,2)]){tip="地址编码错误";pass=false;}else{if(code.length==18){code=code.split('');var factor=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2];var parity=[1,0,'X',9,8,7,6,5,4,3,2];var sum=0;var ai=0;var wi=0;for(var i=0;i<17;i++){ai=code[i];wi=factor[i];sum+=ai*wi;}var last=parity[sum%11];if(parity[sum%11]!=code[17]){tip="校验位错误";pass=false;}}}return{valid:pass,err:tip};}function validateMobile(str){var
re=/^1\d{10}$/
if(re.test(str)){return true;}else{return false;}}