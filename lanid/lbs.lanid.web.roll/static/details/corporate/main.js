/** * Created by rollandsafort on 3/20/15. */console.log('public public detail loaded...')lbs.routes['/workspace/profile/corporatedetail'] = {mod: 'lbs.workspace.profileCorporateDetailPage', location: '/workspace/profile/main.js'};lbs.routes['/details:nomenu'] = {mod: 'lbs.details:nomenu', location: '/details/main.js'};lbs.routes['/details/corporate/corporatedetail'] = {mod: 'lbs.details:corporatedetail', location: '/details/corporate/main.js'};lbs.modules['/details/corporate/corporatedetail'] = {    container : '#main_container'    ,parent:null    ,mainView:'/home/detailPages/lanSearch.html'    ,publicCorporateDetails:null    ,create:function(){        var me = this;      //this.publicCorporateDetails =  Object.create( lbs.workspace.profileCorporateDetailPage);      //      //  console.log(' ------this.publicCorporateDetails-----', this.publicCorporateDetails);      //      //  this.publicCorporateDetails.parent = lbs['details:nomenu']      //      //  lbs['details:corporatedetail']=lbs['/details/corporate/corporatedetail'] = this;        me.publicCorporateDetails = Object.create(lbs.workspace.profileCorporateDetailPage);        me.publicCorporateDetails.parent = lbs['details:nomenu'];        me.publicCorporateDetails.container = this.container;        console.log('me.publicCorporateDetails----',me.publicCorporateDetails);        lbs['details:corporatedetail'] = this;        delete this.deps;        delete this.create;    }    ,render:function render(arg){        var me = this;        arg = arg || {}        var url = $.param.fragment().split('/');        var code = url.pop();        console.log('code----',code);        var endpoint = '/details/search/corporateDetails/'+code +'.json';        var previousPage = jQuery.param.fragment().split("/")[2];        var previousUrl = '';        var previousPageName = '';        console.log('previousPage page-----',previousPage);        if(previousPage==='search'){            previousUrl = '/#/home/detailPages/search/all';            previousPageName = '搜索页';        }        var config = {};        config.previousUrl = previousUrl;        config.previousPageName = previousPageName;        return  $.when(                lbs.modHelper.getMessage(endpoint,false,null),            (lbs.user&& lbs.basemodule.endPoints["profile:"+lbs.user.userType])?lbs.modHelper.getMessage(lbs.basemodule.endPoints["profile:"+lbs.user.userType],false,{}):{pl:null})                .then(function(details,userprofile){                    var detailInfo = details.pl;                    var user = null;                    var profile = userprofile.pl;                    if(detailInfo&&detailInfo.ow&&detailInfo.ow.oID&&profile&&profile.ow&&profile.ow.oID){                        if(detailInfo.ow.oID === profile.ow.oID){                            user = true;                        }                    }                    arg.user =  user;                    arg.details = detailInfo;                    arg.config = config;                    me.publicCorporateDetails.render(arg);                });    }    ,basePath:'/details'    ,deps:['/details:nomenu','/workspace/profile/corporatedetail']};