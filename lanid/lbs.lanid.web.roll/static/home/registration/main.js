/** * Created by rollandsafort on 3/19/15. */console.log('registration is loaded...');lbs.routes['/basemodule'] = {mod: 'lbs.basemodule', location: '/basemodule.js'};lbs.routes['/details:nomenu'] = {mod: 'lbs.details:nomenu', location: '/details/main.js'};lbs.routes['/home/registration/user'] = {mod: 'lbs.home:registration', location: '/home/registration/main.js'};lbs.modules['/home/registration/user'] = {    container : '#main_container'    ,parent:null    ,mainView:'/home/registration/userRegistration.html'    ,create:function(){        var me = this;        this.parent = lbs['details:nomenu'];        lbs['home:registration'] = this;        this.handlers['register:submit'] = function(e){            me.submitUserRegistration(e);        }        this.handlers['register:select:usertype:personal'] = function(e){            me.userSelectedPersonalType(e);        }        this.handlers['register:select:usertype:corporate'] = function(e){            me.userSelectedCorporateType(e);        }        delete this.deps;        delete this.create;    }    ,basePath:'/details'    ,deps:['/details:nomenu']    ,render : function render(arg){        var me = this;        arg = arg || {};        arg.registration = true;        return this.parent.render(arg)            .then(function(){                lbs.modHelper.getView(me.mainView)                    .then(function(view){                        lbs.modHelper.setContainer({                            container:me.container                            ,html:view                        })                      //  jQuery(me.container).addClass('gray_bg');                        $("#conformPassword").keyup(checkPasswordMatch);                            passWordStrengh();                        randomString();                        lbs.actionHandler({                            container:me.container                            ,handlers:me.handlers                        })                    })            })    }   ,submitUserRegistration: function submitUserRegistration(e,endpoint){        e.preventDefault();        console.log('submiting user registration------');        var loginFailMsg = {'1':"注册操作出错了， 请重试 !!",'2':"验证码错误 !!"};        var registrationFail = function(msg){            alert(loginFailMsg[msg]);        };        var registeredUser = jQuery('#userRegistrationForm').serializeObject();        var ep = endpoint||'/home/registration.json';        console.log('registeredUser-----',registeredUser)        if($("#home_system_captcha").text()=== $("#antiBot").val()){            //  lbs.modHelper.getMessage('/workspace/profiles/v1/corporateDetails/audios.json',null,null,'POST', newaudio)            lbs.modHelper.getMessage(ep,null,null,'POST',registeredUser)                .then(function(response){                    console.log("made into thing")                    var latest = response.pl;                    if(latest&&latest.status){                        console.log('registration posted sucessfully-----',latest);                        lbs.fistTimeLogin = true;          //set parameter to enable user welcome popup on workspace                        $.bbq.pushState('#/workspace/welcome');                    }                    else{                        registrationFail('1');                    }                })                .then(null,function(e){                    console.log("getmessage failure",e)                });        }        else{            registrationFail('2');        }    }   ,userSelectedPersonalType: function userSelectedPersonalType(e){        console.log('personal type-----');        $(e.target).addClass('regBoxHeaderSelectedUserTypePern');        $(e.target).parents().siblings().find('.mainFrame').removeClass('regBoxHeaderSelectedUserTypeCorp');        $(e.target).siblings('.arrowFrame').removeClass('hide');        $(e.target).parents().siblings().find('.arrowFrame').addClass('hide');        $("#regBox #userType").val("personal");    }   ,userSelectedCorporateType: function userSelectedCorporateType(e){        console.log('corporate type-----');        $(e.target).addClass('regBoxHeaderSelectedUserTypeCorp');        $(e.target).parents().siblings().find('.mainFrame').removeClass('regBoxHeaderSelectedUserTypePern');        $(e.target).siblings('.arrowFrame').removeClass('hide');        $(e.target).parents().siblings().find('.arrowFrame').addClass('hide');        $("#regBox #userType").val("corporate");    }    ,handlers:{    }};