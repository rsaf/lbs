/* 
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */

//Model Dependencies ===============================

var lib = require("lib");

module.exports = function (paramMongoose){
  var BusinessRecordSchema = paramMongoose.Schema({
      s : lib.permissionsSchema({all:""}),
    //_id: String,
    //createdOn: {type: Date, default: Date.now},
     btc: String //Business transaction code
    ,acn: String //activity name
    ,ac: String // activity code
    ,rc: String //response code
    ,serviceCode: String ///// service code
    ,spt: Date //service processed time
    ,svn: { type: paramMongoose.Schema.Types.ObjectId, ref: 'servicenames',required:true } // service name code
    ,st: {type:Number, default:20} // business record status: 10->PENDING/等待 20->ISSUED/未处理, 30->PAID/已付款, 40->UNDERPROCESSING/正在处理, 50->PROCESSED/已处理, 51->REJECTED/取消
    ,uid:String // user login account , customer who bought the service
    ,usn: String //user name , customer who bought the service
    ,svp: String //service price
    ,service:{ type: paramMongoose.Schema.Types.ObjectId, ref: 'services',required:true }
    ,oID: String
    ,ct: { //creator
      cd: {type: Date, default: Date.now}//creation date
    }
  });
    BusinessRecordSchema.statics.recordsByOrganization = function(organizationName, paramCallback){
        return this.find({"ds":{"$ne":true},"oID" : organizationName})
            .populate('service')
            .populate('svn')
            .exec(paramCallback); //static method

        //db.services.ensureIndex({'ct.cuID':1,'md.lu':-1})
    };
  return BusinessRecordSchema;
};