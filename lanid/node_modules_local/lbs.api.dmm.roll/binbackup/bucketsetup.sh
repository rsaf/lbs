#!/bin/bash
#BASH FILE TO AUTOMATICALLY SETUP FILE STORAGE BUCKET AND UPLOADBOT USER FOR LOCAL TESTING OF PHOTOS, FORMS, FILES UPLOAD

echo 'whoami '
whoami

echo 'generate uploadbot .ssh key pays'
ssh-keygen -f ~leo/.ssh/uploadbot

whoami
echo 'creating uploadbot .ssh folder'
rm -rf ~uploadbot/.ssh
mkdir ~uploadbot/.ssh
chown uploadbot ~uploadbot/.ssh
chmod 700 ~uploadbot/.ssh
echo
whoami
sudo su
whoami
echo 'copying uploadbot.pub from user folder to uploadbot authorized keys'
sudo cp ~leo/.ssh/uploadbot.pub ~uploadbot/.ssh/authorized_keys_temp
echo 
PK_TEMP_CMD='command="~/bin/main.sh"'
echo -n $PK_TEMP_CMD "" > ~uploadbot/.ssh/authorized_keys
echo 'the current value of authorized keys after echoing the PK_TEMP_CMD into it..'
cat ~uploadbot/.ssh/authorized_keys
echo 
cat ~uploadbot/.ssh/authorized_keys_temp  >> ~uploadbot/.ssh/authorized_keys
echo 
echo 'showing the content of authorized keys '
cat ~uploadbot/.ssh/authorized_keys

sudo chown -R uploadbot:staff ~uploadbot/.ssh
sudo chmod 600 ~uploadbot/.ssh/authorized_keys
ls -al ~uploadbot/.ssh/authorized_keys
echo
whoami
echo
echo 'testing ... ssh to uploadbot@localhost'

ssh -i ~leo/.ssh/uploadbot uploadbot@localhost
