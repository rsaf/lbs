/**
 * Created by leo on 4/29/15.
 */


module.exports.getSMTPClient  = function(param_module_ns){

    var smtpConfig = require('./configs.json').smtpconfig;
    var smtpTransport = require('nodemailer-smtp-transport');
    var smtpClient = require('nodemailer').createTransport(smtpTransport(smtpConfig.options));
    var Q = require('q');

    var params = {
        "from": null,
        "to": null,
        "subject": null,
        "text": null
    };

        return function sendEMail(m){
            var r ={"pl":null, "er":null};
            var deferred = Q.defer();

            params.from = smtpConfig.from;
            params.to = m.pl.to;
            params.subject = m.pl.subject;
            params.text = m.pl.text;
            console.log("CMM: SENDING EMAIL TO ... " , params.to);

            smtpClient.sendMail(params, function(err, result) {
                if(!err) {
                    r.pl = true;
                    console.log("CMM: EMAIL SENT TO ... " , params.to);
                    deferred.resolve(r);
                }

                else{
                    r.er = "error occured in sending message, function sendEmail";
                    deferred.reject(r);
                }

            });
            return deferred.promise;
        }

};

