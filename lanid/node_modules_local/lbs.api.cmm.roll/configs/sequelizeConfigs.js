/**
 * Created by LBS006 on 2/23/15.
 */
/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */

var sequelizeORMs = [];
var Sequelize = require('sequelize');

function getDBConfig(){
    return require('./configs.json').pgconfig;
}

module.exports.getSequelize  = function(paramDB){

    // initialize database connection
    var seqConfig = getDBConfig();
    //console.log('connection variables', seqConfig.user, seqConfig.pass, seqConfig.host);
    //console.log('development environment ..', process.env.STAGE ==='development' );

    var sequelizeORM = new Sequelize(paramDB,seqConfig.user,seqConfig.pass, {host: seqConfig.host,logging: false, dialect: 'postgres',port:seqConfig.port });
    //var sequelizeORM = new Sequelize(paramDB,seqConfig.user, {hostname: seqConfig.host,logging: false, dialect: 'postgres',port:seqConfig.port });

    sequelizeORMs.push(sequelizeORM);

    console.log('cmm: connecting to postgresql db for ' + sequelizeORM.config.database);
    return sequelizeORM;

};

process.on('SIGINT', function(){

    for (var i in sequelizeORMs){
        console.log('Closing postgreSQL connection for: ' + sequelizeORMs[i].config.database );
        sequelizeORMs[i].close();
    }
    process.exit(0);
});

